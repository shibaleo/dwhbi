---
title: QPI 実装方針
description: 本システムにおけるQPIモデルの実装方針
sidebar:
  order: 23
---

# QPI 実装方針

本システムは[QPIモデル](../010-theory/011-qpi-model)に基づいて設計されている。ここでは、4 practicesをどのように実装するかを説明する。

## 4 practices の実装

| practice | 実装方式 | 出力 |
|----------|----------|------|
| **log** | Pythonスクリプトによる外部API自動取得 | actual |
| **analyze** | dbt + ML による推定値算出 | estimate |
| **aim** | 管理コンソールでユーザーが入力 | draft |
| **adjust** | LLM APIで現実的に調整 | target |

### log（データ自動収集）

外部サービス（Toggl、Fitbit、Zaim等）のAPIからデータを自動取得する。

- **実装**: Pythonスクリプト（GitHub Actionsで定期実行）
- **出力**: actual（実績データ）
- **保存先**: raw層（JSONB形式）

### analyze（データ変換・分析）

収集したデータを変換し、推定値を算出する。

- **データ変換**: dbtによるSQL変換（raw → staging → core）
- **推定値算出**: MLモデルまたは統計的手法
- **出力**: estimate（推定値）

### aim（目標草案入力）

ユーザーが願望・理想としてdraftを入力する。

- **実装**: 管理コンソールのUI
- **入力者**: ユーザー自身（値の算出はシステムのスコープ外）
- **出力**: draft（目標草案）

### adjust（目標値自動調整）

draftをestimateやユーザー傾向を考慮して現実的に調整する。

- **実装**: LLM API（Groq/Llama等）
- **入力**: draft + estimate + actual履歴 + ユーザー傾向 + 外部制約
- **出力**: target（現実的な目標値）

## 4 informationのスキーマ独立性

4 informationは同じドメインを異なる視点で捉えるものであり、それぞれのスキーマ（列構成）は異なる。

| information | 特性 | スキーマ例（時間ドメイン） |
|-------------|------|---------------------------|
| actual | 外部サービス由来の詳細データ | 開始時刻、終了時刻、タグ、プロジェクト |
| estimate | 統計的に算出された集計値 | カテゴリ、期間、推定時間、信頼区間 |
| draft | ユーザーが設定する願望値 | カテゴリ、期間、目標時間 |
| target | 調整済み目標 | カテゴリ、期間、目標時間、調整理由 |

これらは「同じスキーマで比較する」のではなく、「同じドメイン内で関連づけて分析する」設計となる。

## LLMへのコンテキスト提供

本システムで蓄積されるすべてのデータは、LLMへのコンテキストとしても活用される。

```
ユーザー → LLM → MCP → Supabase → 分析結果
```

- **actual**: 実績の振り返り、傾向分析
- **estimate**: 予測の根拠、計画の参考
- **draft**: ユーザーの意図・願望の理解
- **target**: 目標達成状況の確認

MCP（Model Context Protocol）を通じてLLMがDBに直接アクセスし、自然言語で分析・インサイト提供を行う設計となっている。
