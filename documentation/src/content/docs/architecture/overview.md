---
title: アーキテクチャ概要
---


## システム全体図

```
┌─────────────────────────────────────────────────────────────────────┐
│                        External APIs                                 │
│  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐    │
│  │Toggl │ │GCal  │ │ Zaim │ │Fitbit│ │Tanita│ │Trello│ │TickT │    │
│  └──┬───┘ └──┬───┘ └──┬───┘ └──┬───┘ └──┬───┘ └──┬───┘ └──┬───┘    │
└─────┼────────┼────────┼────────┼────────┼────────┼────────┼────────┘
      └────────┴────────┴────────┼────────┴────────┴────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    Python Pipelines (GitHub Actions)                 │
│                    pipelines/services/*.py                           │
└─────────────────────────────────────────────────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         Supabase (PostgreSQL)                        │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │  raw.*         → 生データ（テーブル）           ✅ 実装済み   │ │
│  │  staging.*     → クリーニング（ビュー）         ⏳ 未着手     │ │
│  │  core.*        → サービス統合（ビュー）         ⏳ 未着手     │ │
│  │  marts.*       → 分析集計（ビュー）             ⏳ 未着手     │ │
│  │  credentials.* → 認証情報（暗号化）             ✅ 実装済み   │ │
│  └────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────┐
│                      Grafana Cloud (将来)                            │
│                   PostgreSQL Datasource → Dashboard                  │
└─────────────────────────────────────────────────────────────────────┘
```

## データフロー

```
External APIs
    ↓ Python (pipelines/)
raw.* テーブル
    ↓ dbt models [将来]
staging.* ビュー
    ↓ dbt models [将来]
core.* ビュー
    ↓ dbt models [将来]
marts.* ビュー
    ↓ PostgreSQL
Grafana Cloud [将来]
```

## 設計思想

| 原則 | 説明 |
|------|------|
| **60年運用** | PostgreSQL + Python + dbt は枯れた技術スタック |
| **テンプレート提供** | ユーザーが全リソースを所有し、提供者への依存なく運用可能 |
| **サービス非依存** | core層以降ではサービス名が消え、将来の移行に耐える |

### ドキュメント方針（60年運用のために）

フレームワーク（VitePress, Jekyll等）は廃れる可能性があるが、**Markdownファイル自体は永続する**。
そのため、コンテンツとテンプレートを分離し、コンテンツには独自記法を混ぜない。

```
┌─────────────────────────────────────────┐
│  コンテンツ（*.md）= 純粋なMarkdownのみ │  ← 絶対に汚さない
├─────────────────────────────────────────┤
│  テンプレート/設定 = フレームワーク依存OK │  ← 消えても再構築可能
└─────────────────────────────────────────┘
```

**docs/*.md で許可する記法（GitHub Flavored Markdown）**:

```markdown
# 見出し
- リスト
[リンク](./other.md)
| テーブル | OK |
```

**docs/*.md で禁止する記法（フレームワーク依存）**:

```markdown
{% include header.md %}        <!-- Liquid -->
{{ site.baseurl }}             <!-- Liquid -->
::: tip                        <!-- VitePress -->
<Tabs>                         <!-- Docusaurus/React -->
{% hint style="info" %}        <!-- GitBook -->
```

この原則により、将来どのフレームワークに移行しても、または静的ファイルとして読んでも、ドキュメントの内容は失われない。

## 対象データドメイン

| ドメイン | データソース | ステータス |
|---------|------------|:----------:|
| 時間管理 | Toggl Track, Google Calendar | ✅ |
| 支出管理 | Zaim | ✅ |
| 健康管理 | Fitbit, Tanita | ✅ |
| タスク管理 | TickTick, Trello | ✅ |
| マスタ管理 | Airtable | ✅ |
| 知識管理 | Notion, Obsidian | ⏳ 将来 |
| 栄養管理 | あすけん等 | ⏳ 将来 |

## 最小構成

| サービス | 役割 | 無料枠 |
|---------|------|--------|
| **GitHub** | コード、Actions（同期ジョブ） | 2000分/月 |
| **Supabase** | PostgreSQL、認証情報保存 | 500MB |

## 関連ドキュメント

- [DWH 4層アーキテクチャ](dwh_layers.md)
- [認証・セキュリティ設計](security.md)
- [テーブル定義書](../database/table_design.md)
