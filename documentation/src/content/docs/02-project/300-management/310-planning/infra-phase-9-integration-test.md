---
title: "Phase 9: çµ±åˆãƒ†ã‚¹ãƒˆãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™"
description: ä¸¦è¡Œé‹ç”¨ã®å‹•ä½œç¢ºèªã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œæˆï¼ˆPhase B å®Œäº†ï¼‰
---

# Phase 9: çµ±åˆãƒ†ã‚¹ãƒˆãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™

## æ¦‚è¦

| é …ç›® | å†…å®¹ |
|------|------|
| ç›®çš„ | å…¨ã‚·ã‚¹ãƒ†ãƒ ã®çµ±åˆãƒ†ã‚¹ãƒˆã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œæˆ |
| å‰ææ¡ä»¶ | Phase 1-8 å®Œäº† |
| æˆæœç‰© | Phase B å®Œäº†ï¼ˆä¸¦è¡Œé‹ç”¨å¯èƒ½ãªçŠ¶æ…‹ï¼‰ |
| æƒ³å®šä½œæ¥­ | E2E ãƒ†ã‚¹ãƒˆã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–° |

---

## Phase B å®Œäº†çŠ¶æ…‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Production Environment                        â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Browser    â”‚      â”‚   Vercel     â”‚      â”‚   Supabase   â”‚   â”‚
â”‚  â”‚              â”‚â”€â”€â”€â”€â”€â–ºâ”‚   (console)  â”‚â”€â”€â”€â”€â”€â–ºâ”‚  (PostgreSQL)â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                      â–²           â”‚
â”‚                               â”‚ /api/sync/*          â”‚           â”‚
â”‚                               â–¼                      â”‚           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Cloudflare Tunnel                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                               â”‚                                  â”‚
â”‚                               â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      OCI VM                                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚              Docker Compose                          â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  server   â”‚  â”‚cloudflaredâ”‚  â”‚ connector â”‚        â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  (Hono)   â”‚  â”‚           â”‚  â”‚  (cron)   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”˜
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ transform â”‚  â”‚ reporter  â”‚                       â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  (cron)   â”‚  â”‚  (cron)   â”‚                       â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Step 9.1: ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ç¢ºèª

**ç›®çš„:** å…¨ã‚µãƒ¼ãƒ“ã‚¹ãŒæ­£å¸¸ã«èµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

### ã‚¿ã‚¹ã‚¯

| # | ã‚¿ã‚¹ã‚¯ | ã‚³ãƒãƒ³ãƒ‰ | çŠ¶æ…‹ |
|---|--------|---------|------|
| 9.1.1 | SSH æ¥ç¶š | `ssh lifetracer` | â¬œ |
| 9.1.2 | Docker çŠ¶æ…‹ç¢ºèª | `docker compose ps` | â¬œ |
| 9.1.3 | server ãƒ­ã‚°ç¢ºèª | `docker compose logs server` | â¬œ |
| 9.1.4 | cloudflared ãƒ­ã‚°ç¢ºèª | `docker compose logs cloudflared` | â¬œ |

### ç¢ºèªã‚³ãƒãƒ³ãƒ‰

```bash
ssh lifetracer

cd /opt/supabase-sync-jobs/infra

# ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹
docker compose ps

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›
# NAME                 STATUS              PORTS
# server               Up (healthy)        0.0.0.0:3000->3000/tcp
# cloudflared          Up
```

---

## Step 9.2: ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç–é€šç¢ºèª

**ç›®çš„:** å¤–éƒ¨ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª

### ã‚¿ã‚¹ã‚¯

| # | ã‚¿ã‚¹ã‚¯ | ã‚³ãƒãƒ³ãƒ‰ | çŠ¶æ…‹ |
|---|--------|---------|------|
| 9.2.1 | server ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ (å†…éƒ¨) | `curl localhost:3000/health` | â¬œ |
| 9.2.2 | server ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ (å¤–éƒ¨) | `curl https://api.example.com/health` | â¬œ |
| 9.2.3 | console ã‚¢ã‚¯ã‚»ã‚¹ | ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèª | â¬œ |
| 9.2.4 | Supabase æ¥ç¶šç¢ºèª | console ã§ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º | â¬œ |

### ç¢ºèªã‚³ãƒãƒ³ãƒ‰

```bash
# VM å†…éƒ¨ã‹ã‚‰
curl http://localhost:3000/health
# {"status":"ok","timestamp":"..."}

# å¤–éƒ¨ã‹ã‚‰ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ï¼‰
curl https://api.lifetracer.example.com/health
# {"status":"ok","timestamp":"..."}

# SSL è¨¼æ˜æ›¸ç¢ºèª
curl -vI https://api.lifetracer.example.com/health 2>&1 | grep "SSL certificate"
```

---

## Step 9.3: åŒæœŸãƒ•ãƒ­ãƒ¼ E2E ãƒ†ã‚¹ãƒˆ

**ç›®çš„:** console â†’ server â†’ Supabase ã®åŒæœŸãƒ•ãƒ­ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆ

### ã‚¿ã‚¹ã‚¯

| # | ã‚¿ã‚¹ã‚¯ | è©³ç´° | çŠ¶æ…‹ |
|---|--------|------|------|
| 9.3.1 | console ãƒ­ã‚°ã‚¤ãƒ³ | Supabase Auth | â¬œ |
| 9.3.2 | Toggl åŒæœŸãƒœã‚¿ãƒ³ | ã‚¯ãƒªãƒƒã‚¯â†’æˆåŠŸç¢ºèª | â¬œ |
| 9.3.3 | GCal åŒæœŸãƒœã‚¿ãƒ³ | ã‚¯ãƒªãƒƒã‚¯â†’æˆåŠŸç¢ºèª | â¬œ |
| 9.3.4 | Supabase ãƒ‡ãƒ¼ã‚¿ç¢ºèª | raw_* ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ | â¬œ |
| 9.3.5 | server ãƒ­ã‚°ç¢ºèª | åŒæœŸãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹ | â¬œ |

### ãƒ†ã‚¹ãƒˆæ‰‹é †

1. `https://console.lifetracer.example.com` ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ­ã‚°ã‚¤ãƒ³
3. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã€ŒSync Togglã€ã‚¯ãƒªãƒƒã‚¯
4. æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç¢ºèª
5. Supabase Dashboard ã§ `raw_toggl_time_entries` ç¢ºèª
6. VM ã§ `docker compose logs server` ç¢ºèª

---

## Step 9.4: cron å®Ÿè¡Œç¢ºèª

**ç›®çš„:** cron ã«ã‚ˆã‚‹æ—¥æ¬¡ãƒãƒƒãƒãŒå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª

### ã‚¿ã‚¹ã‚¯

| # | ã‚¿ã‚¹ã‚¯ | è©³ç´° | çŠ¶æ…‹ |
|---|--------|------|------|
| 9.4.1 | crontab ç¢ºèª | `crontab -l` | â¬œ |
| 9.4.2 | æ‰‹å‹•å®Ÿè¡Œãƒ†ã‚¹ãƒˆ | å„ã‚¸ãƒ§ãƒ–ã‚’æ‰‹å‹•å®Ÿè¡Œ | â¬œ |
| 9.4.3 | ãƒ­ã‚°å‡ºåŠ›ç¢ºèª | `/var/log/supabase-sync-jobs/` | â¬œ |
| 9.4.4 | ç¿Œæ—¥è‡ªå‹•å®Ÿè¡Œç¢ºèª | ç¿Œæ—¥ãƒ­ã‚°ã‚’ç¢ºèª | â¬œ |

### æ‰‹å‹•å®Ÿè¡Œãƒ†ã‚¹ãƒˆ

```bash
cd /opt/supabase-sync-jobs/infra

# Toggl åŒæœŸ
docker compose run --rm connector npm run sync:toggl
echo $?  # 0 ãªã‚‰æˆåŠŸ

# GCal åŒæœŸ
docker compose run --rm connector npm run sync:gcal
echo $?

# dbt å¤‰æ›
docker compose run --rm transform dbt run
echo $?

# ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
docker compose run --rm reporter npm run generate
echo $?

# ãƒ­ã‚°ç¢ºèª
tail -20 /var/log/supabase-sync-jobs/sync.log
tail -20 /var/log/supabase-sync-jobs/dbt.log
tail -20 /var/log/supabase-sync-jobs/reporter.log
```

---

## Step 9.5: GitHub Actions CI ç¢ºèª

**ç›®çš„:** CI ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª

### ã‚¿ã‚¹ã‚¯

| # | ã‚¿ã‚¹ã‚¯ | è©³ç´° | çŠ¶æ…‹ |
|---|--------|------|------|
| 9.5.1 | ãƒ†ã‚¹ãƒˆ PR ä½œæˆ | å°ã•ãªå¤‰æ›´ | â¬œ |
| 9.5.2 | CI å®Ÿè¡Œç¢ºèª | Actions ã‚¿ãƒ– | â¬œ |
| 9.5.3 | lint/test/build æˆåŠŸ | å…¨ã‚¸ãƒ§ãƒ–ç·‘ | â¬œ |
| 9.5.4 | åŒæœŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒãªã„ | Actions ã‚¿ãƒ– | â¬œ |

### ç¢ºèªæ‰‹é †

1. å°ã•ãªå¤‰æ›´ï¼ˆREADME ã® typo fix ãªã©ï¼‰ã§ PR ä½œæˆ
2. GitHub Actions ã‚¿ãƒ–ã§ `ci.yml` ãŒå®Ÿè¡Œã•ã‚Œã‚‹
3. lint, test, build ãŒæˆåŠŸ
4. åŒæœŸé–¢é€£ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆsync-*.ymlï¼‰ãŒè¡¨ç¤ºã•ã‚Œãªã„

---

## Step 9.6: éšœå®³ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ

**ç›®çš„:** éšœå®³ç™ºç”Ÿæ™‚ã®æŒ™å‹•ã‚’ç¢ºèª

### ã‚¿ã‚¹ã‚¯

| # | ã‚¿ã‚¹ã‚¯ | è©³ç´° | çŠ¶æ…‹ |
|---|--------|------|------|
| 9.6.1 | server åœæ­¢æ™‚ | `docker compose stop server` | â¬œ |
| 9.6.2 | cloudflared åœæ­¢æ™‚ | `docker compose stop cloudflared` | â¬œ |
| 9.6.3 | VM å†èµ·å‹•æ™‚ | `sudo reboot` | â¬œ |
| 9.6.4 | è‡ªå‹•å¾©æ—§ç¢ºèª | `restart: unless-stopped` | â¬œ |

### server åœæ­¢ãƒ†ã‚¹ãƒˆ

```bash
# server åœæ­¢
docker compose stop server

# å¤–éƒ¨ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆ502 ã¾ãŸã¯æ¥ç¶šã‚¨ãƒ©ãƒ¼ï¼‰
curl https://api.lifetracer.example.com/health
# æœŸå¾…: ã‚¨ãƒ©ãƒ¼

# server å†èµ·å‹•
docker compose start server

# å¾©æ—§ç¢ºèª
curl https://api.lifetracer.example.com/health
# æœŸå¾…: {"status":"ok",...}
```

### VM å†èµ·å‹•ãƒ†ã‚¹ãƒˆ

```bash
# VM å†èµ·å‹•
sudo reboot

# å†æ¥ç¶šå¾Œ
ssh lifetracer
cd /opt/supabase-sync-jobs/infra

# ã‚µãƒ¼ãƒ“ã‚¹ãŒè‡ªå‹•èµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
docker compose ps
# server, cloudflared ãŒ Up ã§ã‚ã‚‹ã“ã¨
```

---

## Step 9.7: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

**ç›®çš„:** æ§‹æˆå¤‰æ›´ã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«åæ˜ 

### ã‚¿ã‚¹ã‚¯

| # | ã‚¿ã‚¹ã‚¯ | è©³ç´° | çŠ¶æ…‹ |
|---|--------|------|------|
| 9.7.1 | ADR-007 ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–° | æ‰¿èªæ¸ˆã¿ / å®Ÿè£…æ¸ˆã¿ | â¬œ |
| 9.7.2 | infrastructure-plan æ›´æ–° | Phase B å®Œäº† | â¬œ |
| 9.7.3 | infra/README.md å®Œæˆ | ä½¿ç”¨æ–¹æ³•ã€ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒˆ | â¬œ |
| 9.7.4 | é‹ç”¨æ‰‹é †æ›¸ä½œæˆ | æ—¥å¸¸é‹ç”¨ã€ç·Šæ€¥å¯¾å¿œ | â¬œ |

### ADR-007 æ›´æ–°

```markdown
# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: å®Ÿè£…æ¸ˆã¿

## å®Ÿè£…æ—¥
- Phase A â†’ Phase B: 2025-XX-XX
```

### infrastructure-plan æ›´æ–°

```markdown
## ç§»è¡Œãƒ•ã‚§ãƒ¼ã‚ºæ¦‚è¦

| ãƒ•ã‚§ãƒ¼ã‚º | çŠ¶æ…‹ | å†…å®¹ |
|---------|------|------|
| Phase A | âœ… å®Œäº† | GitHub Actions ã§åŒæœŸå®Ÿè¡Œ |
| Phase B | âœ… å®Œäº† | ä¸¦è¡Œé‹ç”¨ï¼ˆserver API + cronï¼‰ |
| Phase C | ğŸ“… å°†æ¥ | GitHub Actions ã¯ CI/CD å°‚ç”¨ã«å®Œå…¨ç§»è¡Œ |
```

---

## Step 9.8: é‹ç”¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆä½œæˆ

**ç›®çš„:** æ—¥å¸¸é‹ç”¨ã®ãŸã‚ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ä½œæˆ

### ã‚¿ã‚¹ã‚¯

| # | ã‚¿ã‚¹ã‚¯ | è©³ç´° | çŠ¶æ…‹ |
|---|--------|------|------|
| 9.8.1 | æ—¥æ¬¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ | ä½œæˆ | â¬œ |
| 9.8.2 | éšœå®³å¯¾å¿œæ‰‹é † | ä½œæˆ | â¬œ |

### æ—¥æ¬¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

```markdown
## æ—¥æ¬¡ç¢ºèªäº‹é …

- [ ] cron ãƒ­ã‚°ç¢ºèª (`/var/log/supabase-sync-jobs/sync.log`)
- [ ] dbt ãƒ­ã‚°ç¢ºèª (`/var/log/supabase-sync-jobs/dbt.log`)
- [ ] ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆç¢ºèª (`/var/log/supabase-sync-jobs/reporter.log`)
- [ ] Supabase ãƒ‡ãƒ¼ã‚¿ç¢ºèªï¼ˆå‰æ—¥åˆ†ãŒåŒæœŸã•ã‚Œã¦ã„ã‚‹ï¼‰
- [ ] VM ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡ç¢ºèª (`df -h`)

## ã‚³ãƒãƒ³ãƒ‰

```bash
ssh lifetracer
tail -50 /var/log/supabase-sync-jobs/sync.log | grep "$(date -d yesterday +%Y-%m-%d)"
tail -50 /var/log/supabase-sync-jobs/dbt.log | grep "$(date -d yesterday +%Y-%m-%d)"
df -h
```
```

### éšœå®³å¯¾å¿œæ‰‹é †

```markdown
## éšœå®³å¯¾å¿œ

### ã‚µãƒ¼ãƒ“ã‚¹ãŒåœæ­¢ã—ã¦ã„ã‚‹

```bash
ssh lifetracer
cd /opt/supabase-sync-jobs/infra
docker compose ps          # çŠ¶æ…‹ç¢ºèª
docker compose logs server # ãƒ­ã‚°ç¢ºèª
docker compose up -d       # å†èµ·å‹•
```

### åŒæœŸãŒå¤±æ•—ã—ã¦ã„ã‚‹

1. ãƒ­ã‚°ç¢ºèª: `tail -100 /var/log/supabase-sync-jobs/sync.log`
2. æ‰‹å‹•å®Ÿè¡Œ: `docker compose run --rm connector npm run sync:toggl`
3. ç’°å¢ƒå¤‰æ•°ç¢ºèª: `cat .env | grep TOGGL`

### VM ã«æ¥ç¶šã§ããªã„

1. OCI Console ã§ VM çŠ¶æ…‹ç¢ºèª
2. Public IP å¤‰æ›´ã®æœ‰ç„¡ç¢ºèª
3. Security List ç¢ºèª
```

---

## Step 9.9: Phase B å®Œäº†å®£è¨€

**ç›®çš„:** Phase B å®Œäº†ã‚’ç¢ºèªã—ã€æ¬¡ãƒ•ã‚§ãƒ¼ã‚ºã¸ã®æº–å‚™

### ã‚¿ã‚¹ã‚¯

| # | ã‚¿ã‚¹ã‚¯ | è©³ç´° | çŠ¶æ…‹ |
|---|--------|------|------|
| 9.9.1 | å…¨ãƒã‚§ãƒƒã‚¯é …ç›®ç¢ºèª | ä»¥ä¸‹ã®ãƒªã‚¹ãƒˆ | â¬œ |
| 9.9.2 | ãƒãƒ¼ãƒ å…±æœ‰ | å®Œäº†å ±å‘Š | â¬œ |
| 9.9.3 | Phase C è¨ˆç”»æ›´æ–° | æ¬¡ãƒ•ã‚§ãƒ¼ã‚ºã®æº–å‚™ | â¬œ |

---

## Phase B å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ã‚¤ãƒ³ãƒ•ãƒ©

- [ ] OCI VM ãŒç¨¼åƒä¸­ (lifetracer-vm)
- [ ] Docker / Docker Compose ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿
- [ ] `infra/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå®Œæˆ

### ã‚µãƒ¼ãƒ“ã‚¹

- [ ] server (Hono) ãŒç¨¼åƒä¸­
- [ ] cloudflared (Tunnel) ãŒç¨¼åƒä¸­
- [ ] Cloudflare Tunnel Status: HEALTHY
- [ ] console ãŒ Vercel ã§ç¨¼åƒä¸­

### API

- [ ] `GET /health` ãŒå¿œç­”
- [ ] `POST /api/sync/toggl` ãŒå‹•ä½œ
- [ ] `POST /api/sync/gcal` ãŒå‹•ä½œ
- [ ] console ã‹ã‚‰åŒæœŸãƒœã‚¿ãƒ³ãŒå‹•ä½œ

### è‡ªå‹•åŒ–

- [ ] cron ãŒè¨­å®šæ¸ˆã¿
- [ ] æ—¥æ¬¡åŒæœŸ (01:00 JST) ãŒå‹•ä½œ
- [ ] dbt å¤‰æ› (02:00 JST) ãŒå‹•ä½œ
- [ ] ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ (03:00 JST) ãŒå‹•ä½œ
- [ ] ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒè¨­å®šæ¸ˆã¿

### CI/CD

- [ ] GitHub Actions ã¯ CI ã®ã¿ (ci.yml)
- [ ] åŒæœŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯å‰Šé™¤æ¸ˆã¿
- [ ] deploy-vm.yml ã§æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ ] ADR-007 ãŒã€Œå®Ÿè£…æ¸ˆã¿ã€
- [ ] infrastructure-plan ãŒæ›´æ–°æ¸ˆã¿
- [ ] infra/README.md ãŒå®Œæˆ
- [ ] é‹ç”¨æ‰‹é †æ›¸ãŒä½œæˆæ¸ˆã¿

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ— (Phase C)

Phase B å®Œäº†å¾Œã€ä»¥ä¸‹ã‚’é †æ¬¡å®Ÿæ–½:

1. **Python ã‚µãƒ¼ãƒ“ã‚¹ Docker åŒ–**
   - analyzer (FastAPI + ML/LLM)
   - adjuster (FastAPI + èª¿æ•´ææ¡ˆ)

2. **reporter Docker åŒ–**
   - Node.js + Typst CLI

3. **visualizer ç§»è¡Œ**
   - ãƒ­ãƒ¼ã‚«ãƒ« Grafana â†’ Grafana Cloud

4. **å®Œå…¨ç§»è¡Œ**
   - GitHub Actions åŒæœŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Œå…¨å‰Šé™¤ï¼ˆæ—¢ã« Phase 8 ã§å®Ÿæ–½æ¸ˆã¿ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰
   - console ã‹ã‚‰ã®åŒæœŸã‚’ server API çµŒç”±ã«çµ±ä¸€

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Phase 1: OCI VM æº–å‚™](./infra-phase-1-oci-vm)
- [Phase 2: VM ç’°å¢ƒæ§‹ç¯‰](./infra-phase-2-vm-setup)
- [Phase 3: infra ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ](./infra-phase-3-infra-directory)
- [Phase 4: server ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä½œæˆ](./infra-phase-4-server-package)
- [Phase 5: Cloudflare Tunnel è¨­å®š](./infra-phase-5-cloudflare-tunnel)
- [Phase 6: console ãƒ‡ãƒ—ãƒ­ã‚¤](./infra-phase-6-console-deploy)
- [Phase 7: cron è¨­å®š](./infra-phase-7-cron-setup)
- [Phase 8: GitHub Actions æ•´ç†](./infra-phase-8-github-actions)
- [ADR-007 ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£é…ç½®](/01-product/100-development/130-design/131-decisions/adr_007-infrastructure-layout)
- [ã‚¤ãƒ³ãƒ•ãƒ©æ§‹ç¯‰ãƒ»ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°è¨ˆç”»](./infrastructure-plan)
