# LIFETRACER åŸºæœ¬è¨­è¨ˆæ›¸

| é …ç›® | å†…å®¹ |
|------|------|
| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ | 2.0.0 |
| æœ€çµ‚æ›´æ–°æ—¥ | 2025-12-01 |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | Phase 1å®Œäº†ãƒ»é‹ç”¨ä¸­ |

## ç›®æ¬¡

- [1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#1-ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
- [2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#2-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
- [3. ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ä¸€è¦§](#3-ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ä¸€è¦§)
- [4. DWH 4å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#4-dwh-4å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
- [5. èªè¨¼ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ](#5-èªè¨¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ)
- [6. ãƒ¢ãƒãƒ¬ãƒæ§‹æˆ](#6-ãƒ¢ãƒãƒ¬ãƒæ§‹æˆ)
- [7. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#7-æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
- [8. é…å¸ƒè¨­è¨ˆ](#8-é…å¸ƒè¨­è¨ˆ)
- [9. é‹ç”¨è¨­è¨ˆ](#9-é‹ç”¨è¨­è¨ˆ)
- [10. å®Ÿè£…çŠ¶æ³](#10-å®Ÿè£…çŠ¶æ³)
- [11. TODOï¼ˆå„ªå…ˆåº¦é †ï¼‰](#11-todoå„ªå…ˆåº¦é †)
- [12. å‚è€ƒè³‡æ–™](#12-å‚è€ƒè³‡æ–™)

---

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### 1.1 ç›®çš„

**LIFETRACER = Personal Data Warehouse Platform**

å€‹äººã®ç”Ÿæ´»ãƒ‡ãƒ¼ã‚¿ï¼ˆå¥åº·ãƒ»æ™‚é–“ãƒ»æ”¯å‡ºï¼‰ã‚’çµ±åˆã—ã€60å¹´é–“ã®é•·æœŸé‹ç”¨ã«è€ãˆã‚‹åˆ†æåŸºç›¤ã‚’æä¾›ã™ã‚‹ã€‚

### 1.2 è¨­è¨ˆæ€æƒ³

| åŸå‰‡ | èª¬æ˜ |
|------|------|
| **60å¹´é‹ç”¨** | PostgreSQL + Python + dbt ã¯æ¯ã‚ŒãŸæŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ |
| **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæä¾›** | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¨ãƒªã‚½ãƒ¼ã‚¹ã‚’æ‰€æœ‰ã—ã€æä¾›è€…ã¸ã®ä¾å­˜ãªãé‹ç”¨å¯èƒ½ |
| **ã‚µãƒ¼ãƒ“ã‚¹éä¾å­˜** | coreå±¤ä»¥é™ã§ã¯ã‚µãƒ¼ãƒ“ã‚¹åãŒæ¶ˆãˆã€å°†æ¥ã®ç§»è¡Œã«è€ãˆã‚‹ |

### 1.3 å¯¾è±¡ãƒ‡ãƒ¼ã‚¿ãƒ‰ãƒ¡ã‚¤ãƒ³

| ãƒ‰ãƒ¡ã‚¤ãƒ³ | ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ | ç”¨é€” |
|---------|------------|------|
| å¥åº· | Fitbit, Tanita | ç¡çœ ãƒ»å¿ƒæ‹ãƒ»ä½“çµ„æˆãƒ»è¡€åœ§ |
| æ™‚é–“ | Toggl Track, Google Calendar | æ™‚é–“è¿½è·¡ãƒ»äºˆå®šç®¡ç† |
| æ”¯å‡º | Zaim | å®¶è¨ˆç°¿ |

---

## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 2.1 ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        External APIs                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚Fitbitâ”‚ â”‚Tanitaâ”‚ â”‚Toggl â”‚ â”‚GCal  â”‚ â”‚ Zaim â”‚                       â”‚
â”‚  â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚        â”‚        â”‚        â”‚        â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Python Pipelines (GitHub Actions)                 â”‚
â”‚  pipelines/services/{fitbit,tanita,toggl,gcalendar,zaim}.py         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Supabase                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  raw.*           ç”Ÿãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰                         â”‚   â”‚
â”‚  â”‚  staging.*       ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ãƒ»æ­£è¦åŒ–ï¼ˆãƒ“ãƒ¥ãƒ¼ï¼‰               â”‚   â”‚
â”‚  â”‚  core.*          ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆï¼ˆãƒ“ãƒ¥ãƒ¼ï¼‰                       â”‚   â”‚
â”‚  â”‚  marts.*         åˆ†æé›†è¨ˆï¼ˆãƒ“ãƒ¥ãƒ¼ï¼‰                           â”‚   â”‚
â”‚  â”‚  credentials.*   èªè¨¼æƒ…å ±ï¼ˆæš—å·åŒ–ï¼‰                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Grafana Cloud                                   â”‚
â”‚                   PostgreSQL Datasource â†’ Dashboard                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
External APIs
    â†“ Python (pipelines/)
Supabase raw.*
    â†“ dbt models (transform/models/staging/) [å°†æ¥]
Supabase staging.*
    â†“ dbt models (transform/models/core/) [å°†æ¥]
Supabase core.*
    â†“ dbt models (transform/models/marts/) [å°†æ¥]
Supabase marts.*
    â†“ PostgreSQL datasource
Grafana Cloud
```

---

## 3. ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ä¸€è¦§

### 3.1 å®Ÿè£…æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹

| ã‚µãƒ¼ãƒ“ã‚¹ | èªè¨¼æ–¹å¼ | ãƒ‡ãƒ¼ã‚¿ç¨®é¡ | å®Ÿè£…ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|---------|---------|-----------|--------------|
| **Toggl Track** | Basic Auth (API Token) | clients, projects, tags, entries | âœ… å®Ÿè£…å®Œäº†ãƒ»é‹ç”¨ä¸­ |
| **Google Calendar** | Service Account JWT | events | âœ… å®Ÿè£…å®Œäº†ãƒ»é‹ç”¨ä¸­ |
| **Zaim** | OAuth 1.0a (HMAC-SHA1) | categories, genres, accounts, transactions | âœ… å®Ÿè£…å®Œäº†ãƒ»ãƒ†ã‚¹ãƒˆæ¸ˆã¿ |
| **Fitbit** | OAuth 2.0 | sleep, heart_rate, hrv, activity, spo2 | âœ… å®Ÿè£…å®Œäº†ãƒ»ãƒ†ã‚¹ãƒˆæ¸ˆã¿ |
| **Tanita** | OAuth 2.0 | body_composition, blood_pressure | âœ… å®Ÿè£…å®Œäº†ãƒ»ãƒ†ã‚¹ãƒˆæ¸ˆã¿ |

### 3.2 ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹åˆ¥æ¦‚è¦

#### Toggl Track
- **èªè¨¼**: Basic Auth (`api_token:api_token` ã® Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰)
- **API**: Toggl Track API v9
- **å–å¾—ãƒ‡ãƒ¼ã‚¿**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€ã‚¿ã‚°ã€æ™‚é–“ã‚¨ãƒ³ãƒˆãƒªãƒ¼
- **ç‰¹å¾´**: ä¸¦åˆ—APIå–å¾—ï¼ˆ4ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆåŒæ™‚ï¼‰ã€èªè¨¼æƒ…å ±ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **è©³ç´°è¨­è¨ˆ**: `docs/Detailed_Design/toggl.md`

#### Google Calendar
- **èªè¨¼**: Service Account JWT â†’ Bearer Token
- **API**: Google Calendar API v3
- **å–å¾—ãƒ‡ãƒ¼ã‚¿**: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆé€šå¸¸/çµ‚æ—¥/ç¹°ã‚Šè¿”ã—ï¼‰
- **ç‰¹å¾´**: JWTè‡ªå‰ç”Ÿæˆã€ç¹°ã‚Šè¿”ã—ã‚¤ãƒ™ãƒ³ãƒˆå±•é–‹ï¼ˆsingleEvents=trueï¼‰
- **è©³ç´°è¨­è¨ˆ**: `docs/Detailed_Design/gcalendar.md`

#### Zaim
- **èªè¨¼**: OAuth 1.0a (HMAC-SHA1ç½²åã‚’è‡ªå‰å®Ÿè£…)
- **API**: Zaim API v2
- **å–å¾—ãƒ‡ãƒ¼ã‚¿**: ã‚«ãƒ†ã‚´ãƒªã€ã‚¸ãƒ£ãƒ³ãƒ«ã€å£åº§ã€å–å¼•
- **ç‰¹å¾´**: JSTã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã®UTCå¤‰æ›ã€å¤–éƒ¨ã‚­ãƒ¼é †åºã‚’è€ƒæ…®ã—ãŸä¿å­˜
- **è©³ç´°è¨­è¨ˆ**: `docs/Detailed_Design/zaim.md`

#### Fitbit
- **èªè¨¼**: OAuth 2.0 (è‡ªå‹•ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥)
- **API**: Fitbit Web API
- **å–å¾—ãƒ‡ãƒ¼ã‚¿**: ç¡çœ ã€å¿ƒæ‹æ•°ã€HRVã€æ´»å‹•ã€SpO2
- **ç‰¹å¾´**: ãƒãƒ£ãƒ³ã‚¯å‡¦ç†ï¼ˆ100æ—¥/30æ—¥/1æ—¥ï¼‰ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™ç®¡ç†ï¼ˆ150 req/hï¼‰
- **è©³ç´°è¨­è¨ˆ**: `docs/Detailed_Design/fitbit.md`

#### Tanita Health Planet
- **èªè¨¼**: OAuth 2.0 (è‡ªå‹•ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥)
- **API**: Health Planet API
- **å–å¾—ãƒ‡ãƒ¼ã‚¿**: ä½“çµ„æˆï¼ˆä½“é‡ã€ä½“è„‚è‚ªç‡ï¼‰ã€è¡€åœ§
- **ç‰¹å¾´**: 3ãƒ¶æœˆãƒãƒ£ãƒ³ã‚¯ã€Shift_JISã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å¯¾å¿œã€æ¸¬å®šã‚¿ã‚°ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
- **è©³ç´°è¨­è¨ˆ**: `docs/Detailed_Design/tanita.md`

---

## 4. DWH 4å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 4.1 ç›®æ¨™æ§‹é€ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ marts.*                                                             â”‚
â”‚   åˆ†æãƒ»é›†è¨ˆãƒ“ãƒ¥ãƒ¼                                                  â”‚
â”‚   agg_daily_health, agg_weekly_productivity                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–²
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ core.*                                                              â”‚
â”‚   ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆæ¸ˆã¿ãƒ“ã‚¸ãƒã‚¹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼ˆã‚µãƒ¼ãƒ“ã‚¹åãŒæ¶ˆãˆã‚‹ï¼‰        â”‚
â”‚   fct_time_entries, fct_transactions, dim_categories                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–²
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ staging.*                                                           â”‚
â”‚   ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ãƒ»æ­£è¦åŒ–æ¸ˆã¿ï¼ˆãƒ“ãƒ¥ãƒ¼ï¼‰                                â”‚
â”‚   stg_toggl__entries, stg_zaim__transactions                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–²
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ raw.*                                                               â”‚
â”‚   å¤–éƒ¨APIã‹ã‚‰ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰                                 â”‚
â”‚   toggl_entries, zaim_transactions, fitbit_sleep                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å±¤åˆ¥è¨­è¨ˆ

| å±¤ | å½¹å‰² | ã‚µãƒ¼ãƒ“ã‚¹å | å½¢å¼ | å®Ÿè£…çŠ¶æ³ |
|----|------|-----------|------|---------|
| raw | APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãã®ã¾ã¾ä¿å­˜ | ã‚ã‚Š | ãƒ†ãƒ¼ãƒ–ãƒ« | âœ… å®Ÿè£…æ¸ˆã¿ |
| staging | å‹å¤‰æ›ã€åˆ—åæ­£è¦åŒ–ã€ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¤‰æ› | ã‚ã‚Š | ãƒ“ãƒ¥ãƒ¼ | æœªç€æ‰‹ |
| core | è¤‡æ•°ã‚µãƒ¼ãƒ“ã‚¹ã®çµ±åˆã€ãƒ“ã‚¸ãƒã‚¹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£åŒ– | **ãªã—** | ãƒ“ãƒ¥ãƒ¼ | æœªç€æ‰‹ |
| marts | åˆ†æãƒ»é›†è¨ˆã€ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¥ãƒ“ãƒ¥ãƒ¼ | ãªã— | ãƒ“ãƒ¥ãƒ¼ | æœªç€æ‰‹ |

### 4.3 ã‚µãƒ¼ãƒ“ã‚¹éä¾å­˜ã®è¨­è¨ˆ

coreå±¤ä»¥é™ã§ã¯ã‚µãƒ¼ãƒ“ã‚¹åãŒæ¶ˆãˆã‚‹ã€‚ã“ã‚Œã«ã‚ˆã‚Šï¼š
- å°†æ¥Togglã‹ã‚‰åˆ¥ã‚µãƒ¼ãƒ“ã‚¹ã«ç§»è¡Œã—ã¦ã‚‚ã€core/martså±¤ã¯å¤‰æ›´ä¸è¦
- åˆ†æã‚¯ã‚¨ãƒªã¯ `fct_time_entries` ã‚’å‚ç…§ã—ã€ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’æ„è­˜ã—ãªã„
- stagingå±¤ã§æ–°æ—§ã‚µãƒ¼ãƒ“ã‚¹ã‚’çµ±åˆã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å¸å

### 4.4 å‘½åè¦å‰‡

| å±¤ | ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ | ä¾‹ |
|----|---------------|----|
| raw | `{service}_{entity}` | toggl_entries, fitbit_sleep |
| staging | `stg_{service}__{entity}` | stg_toggl__entries |
| core | `fct_` / `dim_` | fct_time_entries, dim_projects |
| marts | `agg_` / ãƒ‰ãƒ¡ã‚¤ãƒ³å | agg_daily_health |

### 4.5 rawå±¤ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§

| ãƒ†ãƒ¼ãƒ–ãƒ« | ä¸»ã‚­ãƒ¼ | ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ |
|---------|--------|------------|
| `raw.toggl_clients` | id | Toggl |
| `raw.toggl_projects` | id | Toggl |
| `raw.toggl_tags` | id | Toggl |
| `raw.toggl_entries` | id | Toggl |
| `raw.gcalendar_events` | id | Google Calendar |
| `raw.zaim_categories` | (zaim_user_id, id) | Zaim |
| `raw.zaim_genres` | (zaim_user_id, id) | Zaim |
| `raw.zaim_accounts` | (zaim_user_id, id) | Zaim |
| `raw.zaim_transactions` | (zaim_user_id, zaim_id) | Zaim |
| `raw.fitbit_sleep` | log_id | Fitbit |
| `raw.fitbit_heart_rate_daily` | date | Fitbit |
| `raw.fitbit_hrv_daily` | date | Fitbit |
| `raw.fitbit_activity_daily` | date | Fitbit |
| `raw.fitbit_spo2_daily` | date | Fitbit |
| `raw.tanita_body_composition` | measured_at | Tanita |
| `raw.tanita_blood_pressure` | measured_at | Tanita |

---

## 5. èªè¨¼ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### 5.1 èªè¨¼æƒ…å ±ã®ä¿å­˜

```
credentials.services ãƒ†ãƒ¼ãƒ–ãƒ«
â”œâ”€â”€ service: ã‚µãƒ¼ãƒ“ã‚¹å (toggl, fitbit, tanita, zaim, gcalendar)
â”œâ”€â”€ credentials_encrypted: AES-256-GCM æš—å·åŒ–æ¸ˆã¿èªè¨¼æƒ…å ±
â””â”€â”€ expires_at: ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ï¼ˆOAuth 2.0ã®å ´åˆï¼‰
```

### 5.2 æš—å·åŒ–æ–¹å¼

| é …ç›® | å€¤ |
|------|---|
| ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  | AES-256-GCM |
| éµé•· | 256bit (32bytes) |
| Nonce | 12bytes (96bit) |
| éµã®ä¿å­˜å ´æ‰€ | ç’°å¢ƒå¤‰æ•° `TOKEN_ENCRYPTION_KEY` |

### 5.3 èªè¨¼æ–¹å¼åˆ¥ã®å®Ÿè£…

| ã‚µãƒ¼ãƒ“ã‚¹ | èªè¨¼æ–¹å¼ | ä¿å­˜ã™ã‚‹èªè¨¼æƒ…å ± |
|---------|---------|----------------|
| Toggl | Basic Auth | api_token, workspace_id |
| Google Calendar | Service Account | service_account_json (Base64), calendar_id |
| Zaim | OAuth 1.0a | consumer_key, consumer_secret, access_token, access_token_secret |
| Fitbit | OAuth 2.0 | client_id, client_secret, access_token, refresh_token |
| Tanita | OAuth 2.0 | client_id, client_secret, access_token, refresh_token |

### 5.4 ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥æˆ¦ç•¥

| ã‚µãƒ¼ãƒ“ã‚¹ | æœ‰åŠ¹æœŸé™ | ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥é–¾å€¤ | æˆ¦ç•¥ |
|---------|---------|----------------|------|
| Fitbit | 8æ™‚é–“ | 60åˆ†å‰ | è‡ªå‹•ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã€DBã«ä¿å­˜ |
| Tanita | 3æ™‚é–“ | 30åˆ†å‰ | è‡ªå‹•ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã€DBã«ä¿å­˜ |
| Toggl | ãªã— | - | ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ä¸è¦ |
| Google Calendar | 1æ™‚é–“ | - | æ¯å›JWTç”Ÿæˆ |
| Zaim | ãªã— | - | ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ä¸è¦ï¼ˆOAuth 1.0aï¼‰ |

---

## 6. ãƒ¢ãƒãƒ¬ãƒæ§‹æˆ

### 6.1 ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ

```
lifetracer/                           # ãƒ¢ãƒãƒ¬ãƒãƒ«ãƒ¼ãƒˆ
â”‚
â”œâ”€â”€ pipelines/                        # ãƒ‡ãƒ¼ã‚¿åé›†ï¼ˆPythonï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                       # ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼
â”‚   â”œâ”€â”€ services/                     # APIåŒæœŸã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ fitbit.py                 # ~650è¡Œ
â”‚   â”‚   â”œâ”€â”€ tanita.py                 # ~720è¡Œ
â”‚   â”‚   â”œâ”€â”€ toggl.py                  # ~600è¡Œ
â”‚   â”‚   â”œâ”€â”€ zaim.py                   # ~600è¡Œ
â”‚   â”‚   â””â”€â”€ gcalendar.py              # ~480è¡Œ
â”‚   â”œâ”€â”€ lib/                          # å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒª
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ credentials.py            # èªè¨¼æƒ…å ±å–å¾—ãƒ»å¾©å·
â”‚   â”‚   â”œâ”€â”€ db.py                     # Supabase client
â”‚   â”‚   â”œâ”€â”€ encryption.py             # AES-GCMæš—å·åŒ–
â”‚   â”‚   â””â”€â”€ logger.py                 # ãƒ­ã‚®ãƒ³ã‚°
â”‚   â””â”€â”€ utils/                        # æ±ç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ dates.py                  # æ—¥ä»˜æ“ä½œ
â”‚
â”œâ”€â”€ transform/                        # dbt projectï¼ˆãƒ‡ãƒ¼ã‚¿å¤‰æ›ï¼‰[å°†æ¥]
â”‚   â”œâ”€â”€ dbt_project.yml
â”‚   â”œâ”€â”€ profiles.yml
â”‚   â””â”€â”€ models/
â”‚       â”œâ”€â”€ staging/
â”‚       â”œâ”€â”€ core/
â”‚       â””â”€â”€ marts/
â”‚
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ config.toml
â”‚   â”œâ”€â”€ functions/                    # Edge Functionsï¼ˆDenoï¼‰
â”‚   â””â”€â”€ migrations/                   # DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ pipelines/                    # pytest
â”‚       â”œâ”€â”€ test_fitbit.py            # 23ãƒ†ã‚¹ãƒˆ
â”‚       â”œâ”€â”€ test_tanita.py            # 24ãƒ†ã‚¹ãƒˆ
â”‚       â”œâ”€â”€ test_toggl.py             # 12ãƒ†ã‚¹ãƒˆ
â”‚       â”œâ”€â”€ test_zaim.py              # 25ãƒ†ã‚¹ãƒˆ
â”‚       â””â”€â”€ test_gcalendar.py         # 20ãƒ†ã‚¹ãƒˆ
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ DESIGN.md                     # æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆåŸºæœ¬è¨­è¨ˆæ›¸ï¼‰
â”‚   â””â”€â”€ Detailed_Design/              # è©³ç´°è¨­è¨ˆæ›¸
â”‚       â”œâ”€â”€ toggl.md
â”‚       â”œâ”€â”€ gcalendar.md
â”‚       â”œâ”€â”€ zaim.md
â”‚       â”œâ”€â”€ fitbit.md
â”‚       â””â”€â”€ tanita.md
â”‚
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ sync-daily.yml            # å®šæœŸåŒæœŸ [å°†æ¥]
â”‚
â”œâ”€â”€ pyproject.toml                    # Pythonä¾å­˜ç®¡ç†
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ .python-version                   # 3.12+
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .env.example
â””â”€â”€ README.md
```

### 6.2 ãƒ•ã‚©ãƒ«ãƒ€ã®è²¬å‹™

| ãƒ•ã‚©ãƒ«ãƒ€ | è²¬å‹™ | è¨€èª/æŠ€è¡“ | å®Ÿè¡Œç’°å¢ƒ |
|---------|------|----------|---------|
| **pipelines/** | å¤–éƒ¨API â†’ rawå±¤ã¸ã®åŒæœŸ | Python 3.12+ | GitHub Actions |
| **transform/** | raw â†’ staging â†’ core â†’ marts | dbt (SQL) | GitHub Actions |
| **supabase/** | ã‚¤ãƒ³ãƒ•ãƒ©å®šç¾©ã€Edge Functions | SQL, Deno | Supabase |
| **tests/** | å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ†ã‚¹ãƒˆ | pytest | ãƒ­ãƒ¼ã‚«ãƒ«/CI |
| **docs/** | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | Markdown | - |

---

## 7. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### 7.1 ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¥æŠ€è¡“

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | æŠ€è¡“ | å®Ÿè£…çŠ¶æ³ |
|---------|------|---------|
| **APIåŒæœŸ â†’ raw** | Python 3.12+ | âœ… å…¨ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…å®Œäº† |
| **raw â†’ staging** | dbt (SQL) | æœªç€æ‰‹ |
| **staging â†’ core** | dbt (SQL) | æœªç€æ‰‹ |
| **core â†’ marts** | dbt (SQL) | æœªç€æ‰‹ |
| **èªè¨¼ãƒ»æš—å·åŒ–** | Python (cryptography) | âœ… å®Ÿè£…å®Œäº† |
| **DBæ¥ç¶š** | Python (supabase-py) | âœ… å®Ÿè£…å®Œäº† |
| **ãƒ†ã‚¹ãƒˆ** | pytest + pytest-asyncio | âœ… 104ãƒ†ã‚¹ãƒˆ |
| **ç®¡ç†UI** | Next.js + Vercel | ä¿ç•™ |
| **OAuth Callback** | Deno (Edge Functions) | æœªç€æ‰‹ |
| **å¯è¦–åŒ–** | Grafana Cloud | æœªç€æ‰‹ |

### 7.2 Pythonä¾å­˜é–¢ä¿‚

**ä¸»è¦ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**:

| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|-----------|-----------|------|
| httpx | >= 0.27.0 | éåŒæœŸHTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ |
| supabase | >= 2.0.0 | Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ |
| cryptography | >= 41.0.0 | AES-GCMæš—å·åŒ– |
| python-dotenv | >= 1.0.0 | ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿ |
| pytest | >= 8.0.0 | ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ |
| pytest-asyncio | >= 0.23.0 | éåŒæœŸãƒ†ã‚¹ãƒˆ |
| pytest-mock | >= 3.12.0 | ãƒ¢ãƒƒã‚¯ |
| tzdata | >= 2024.1 | Windowsç”¨ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ãƒ‡ãƒ¼ã‚¿ |

---

## 8. é…å¸ƒè¨­è¨ˆ

### 8.1 è¨­è¨ˆå“²å­¦

**ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæä¾›ã«å¾¹ã™ã‚‹**

- ä»–äººã®ã‚¢ãƒ—ãƒªã‚’ç®¡ç†ã—ãªã„
- ãƒªãƒã‚¸ãƒˆãƒªã¯çªç„¶æ¶ˆãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
- å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒçœŸã®æ„å‘³ã§ä¸»å°æ¨©ã‚’æŒã¤

```
ç§ â”€â”€â”€â”€æä¾›â”€â”€â”€â”€â†’ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
                    â†“ fork
ãƒ¦ãƒ¼ã‚¶ãƒ¼ â”€æ‰€æœ‰â”€â†’ å…¨ãƒªã‚½ãƒ¼ã‚¹

ç§ã®ãƒªãƒã‚¸ãƒˆãƒªãŒæ¶ˆãˆã¦ã‚‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚·ã‚¹ãƒ†ãƒ ã¯å‹•ãç¶šã‘ã‚‹
```

### 8.2 æœ€å°æ§‹æˆï¼ˆ2ã‚µãƒ¼ãƒ“ã‚¹ï¼‰

| ã‚µãƒ¼ãƒ“ã‚¹ | å½¹å‰² | ç„¡æ–™æ  |
|---------|------|--------|
| **GitHub** | ã‚³ãƒ¼ãƒ‰ã€Actionsï¼ˆåŒæœŸã‚¸ãƒ§ãƒ–ï¼‰ | Actions 2000åˆ†/æœˆ |
| **Supabase** | PostgreSQLã€èªè¨¼æƒ…å ±ä¿å­˜ | DB 500MB |

### 8.3 ãƒ„ãƒ¼ãƒ«ã®å½¹å‰²åˆ†æ‹…

| ãƒ„ãƒ¼ãƒ« | å½¹å‰² | é »åº¦ |
|--------|------|------|
| GitHub Actions | ãƒ‡ãƒ¼ã‚¿åŒæœŸã‚¸ãƒ§ãƒ– | æ—¥æ¬¡ |
| Supabase | DWHï¼ˆPostgreSQLï¼‰ | å¸¸æ™‚ |
| Grafana Cloud | åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | æ—¥å¸¸çš„ |

---

## 9. é‹ç”¨è¨­è¨ˆ

### 9.1 å®Ÿè¡Œæ–¹æ³•

**æ‰‹å‹•å®Ÿè¡Œ**:
```bash
# ä»®æƒ³ç’°å¢ƒã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆ
source .venv/Scripts/activate  # Git Bash
# ã¾ãŸã¯
.venv\Scripts\activate  # Windows CMD

# å„ã‚µãƒ¼ãƒ“ã‚¹å€‹åˆ¥å®Ÿè¡Œ
python -m pipelines.services.toggl
python -m pipelines.services.gcalendar
python -m pipelines.services.zaim
python -m pipelines.services.fitbit
python -m pipelines.services.tanita
```

**GitHub Actionsï¼ˆäºˆå®šï¼‰**:
```yaml
# .github/workflows/sync-daily.yml
- name: Sync All Services
  run: |
    python -m pipelines.services.toggl
    python -m pipelines.services.gcalendar
    python -m pipelines.services.zaim
    python -m pipelines.services.fitbit
    python -m pipelines.services.tanita
  env:
    SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
    SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
    TOKEN_ENCRYPTION_KEY: ${{ secrets.TOKEN_ENCRYPTION_KEY }}
```

### 9.2 å¿…è¦ãªç’°å¢ƒå¤‰æ•°

`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨­å®šï¼š

```bash
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_SERVICE_ROLE_KEY=eyJ...
TOKEN_ENCRYPTION_KEY=... # 32ãƒã‚¤ãƒˆã®æš—å·åŒ–ã‚­ãƒ¼
```

### 9.3 ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest tests/pipelines/ -v

# ã‚µãƒ¼ãƒ“ã‚¹åˆ¥ãƒ†ã‚¹ãƒˆ
pytest tests/pipelines/test_toggl.py -v      # 12ãƒ†ã‚¹ãƒˆ
pytest tests/pipelines/test_gcalendar.py -v  # 20ãƒ†ã‚¹ãƒˆ
pytest tests/pipelines/test_zaim.py -v       # 25ãƒ†ã‚¹ãƒˆ
pytest tests/pipelines/test_fitbit.py -v     # 23ãƒ†ã‚¹ãƒˆ
pytest tests/pipelines/test_tanita.py -v     # 24ãƒ†ã‚¹ãƒˆ

# ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
pytest tests/pipelines/ --cov=pipelines
```

### 9.4 ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°é …ç›®

| é …ç›® | èª¬æ˜ | ã‚¢ãƒ©ãƒ¼ãƒˆæ¡ä»¶ |
|------|------|------------|
| åŒæœŸæˆåŠŸç‡ | å„ã‚µãƒ¼ãƒ“ã‚¹ã®åŒæœŸæˆåŠŸ/å¤±æ•— | 3æ—¥é€£ç¶šå¤±æ•— |
| ãƒ‡ãƒ¼ã‚¿ä»¶æ•° | å„ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ã‚³ãƒ¼ãƒ‰æ•° | 0ä»¶ |
| å‡¦ç†æ™‚é–“ | åŒæœŸã®æ‰€è¦æ™‚é–“ | 10åˆ†è¶… |
| ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | Fitbit: 150 req/h | 90%è¶… |

---

## 10. å®Ÿè£…çŠ¶æ³

### 10.1 Phase 1 å®Œäº†: Python ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³åŸºç›¤

**å®Ÿè£…æ¸ˆã¿ï¼ˆ2025å¹´12æœˆï¼‰**:

| ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« | è¡Œæ•° | ãƒ†ã‚¹ãƒˆæ•° | ã‚«ãƒãƒ¬ãƒƒã‚¸ |
|-----------|------|---------|-----------|
| `toggl.py` | ~600è¡Œ | 12 | ~90% |
| `gcalendar.py` | ~480è¡Œ | 20 | ~95% |
| `zaim.py` | ~600è¡Œ | 25 | ~95% |
| `fitbit.py` | ~650è¡Œ | 23 | ~90% |
| `tanita.py` | ~720è¡Œ | 24 | ~98% |
| **åˆè¨ˆ** | **~3050è¡Œ** | **104** | **~93%** |

**å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒª**:
- `pipelines/lib/credentials.py` - èªè¨¼æƒ…å ±å–å¾—ãƒ»å¾©å·
- `pipelines/lib/db.py` - Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- `pipelines/lib/encryption.py` - AES-GCMæš—å·åŒ–ï¼ˆDenoç‰ˆã¨äº’æ›ï¼‰
- `pipelines/lib/logger.py` - ãƒ­ã‚®ãƒ³ã‚°è¨­å®š

### 10.2 è¨­è¨ˆåˆ¤æ–­ã®è¨˜éŒ²

#### rawå±¤ã®ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ

**åˆ¤æ–­**: rawå±¤ã¯å‹ä»˜ããƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç¶­æŒã™ã‚‹ï¼ˆå…¨æ–‡å­—åˆ—åŒ–ã—ãªã„ï¼‰

**ç†ç”±**:
- ãƒ‡ãƒ¼ã‚¿å“è³ª: INSERTæ™‚ã«DBå´ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: stagingå±¤ã§æ¯å›CASTã™ã‚‹å¿…è¦ãŒãªã„
- ãƒ‡ãƒãƒƒã‚°: INSERTå¤±æ•—ã§å³åº§ã«ã‚¨ãƒ©ãƒ¼ç™ºè¦‹

#### Pythonãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ 

**åˆ¤æ–­**: Denoç‰ˆã®åˆ†å‰²æ§‹é€ ã‚’Pythonã§ã¯1ãƒ•ã‚¡ã‚¤ãƒ«/ã‚µãƒ¼ãƒ“ã‚¹ã«çµ±åˆ

**ç†ç”±**:
- 5ãƒ•ã‚¡ã‚¤ãƒ« Ã— 6ã‚µãƒ¼ãƒ“ã‚¹ = 30ãƒ•ã‚¡ã‚¤ãƒ« â†’ 5ãƒ•ã‚¡ã‚¤ãƒ«ã«å‰Šæ¸›
- èªçŸ¥è² è·ã®è»½æ¸›ï¼ˆ1ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§å®Œçµï¼‰
- å°è¦æ¨¡ï¼ˆ500-700è¡Œï¼‰ãªã‚‰1ãƒ•ã‚¡ã‚¤ãƒ«ãŒæœ€é©

#### èªè¨¼æƒ…å ±ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥

**åˆ¤æ–­**: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¬ãƒ™ãƒ«å¤‰æ•°ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥

**ç†ç”±**:
- `get_credentials()` ã¯æ¯å› DB ã‚¢ã‚¯ã‚»ã‚¹ã‚’ä¼´ã†
- 1å›ã®åŒæœŸä¸­ã«èªè¨¼æƒ…å ±ã¯å¤‰ã‚ã‚‰ãªã„
- è¤‡æ•°å›ã® DB ã‚¢ã‚¯ã‚»ã‚¹ã‚’1å›ã«å‰Šæ¸›

---

## 11. TODOï¼ˆå„ªå…ˆåº¦é †ï¼‰

### ğŸ”´ å„ªå…ˆåº¦ï¼šé«˜ï¼ˆãƒªãƒªãƒ¼ã‚¹å¿…é ˆï¼‰

| ã‚¿ã‚¹ã‚¯ | å†…å®¹ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|--------|------|------------|
| GitHub Actionsçµ±åˆ | `.github/workflows/sync-daily.yml` ã‚’ Pythonå®Ÿè¡Œã«å¤‰æ›´ | æœªç€æ‰‹ |
| æœ¬ç•ªç’°å¢ƒã§ã®å‹•ä½œç¢ºèª | å…¨ã‚µãƒ¼ãƒ“ã‚¹ã®E2Eãƒ†ã‚¹ãƒˆ | æœªç€æ‰‹ |
| ENCRYPTION KEYå¾©æ—§æ‰‹é † | ãƒˆãƒ¼ã‚¯ãƒ³æš—å·åŒ–ã‚­ãƒ¼ç´›å¤±æ™‚ã®ãƒªã‚«ãƒãƒªæ‰‹é † | æœªç€æ‰‹ |

### ğŸŸ¡ å„ªå…ˆåº¦ï¼šä¸­ï¼ˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ»å“è³ªï¼‰

| ã‚¿ã‚¹ã‚¯ | å†…å®¹ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|--------|------|------------|
| dbtå°å…¥ | `transform/` ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆã€staging/core/martså±¤ã®æ§‹ç¯‰ | æœªç€æ‰‹ |
| Grafana Cloudé€£æº | PostgreSQLãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹è¨­å®šã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä½œæˆ | æœªç€æ‰‹ |
| åŒæœŸå¤±æ•—ã‚¢ãƒ©ãƒ¼ãƒˆ | GitHub Actionså¤±æ•—æ™‚ã®Slack/ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ | æœªç€æ‰‹ |
| ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»ãƒªã‚¹ãƒˆã‚¢æ‰‹é † | Supabaseãƒ‡ãƒ¼ã‚¿ã®å®šæœŸã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ | æœªç€æ‰‹ |

### ğŸŸ¢ å„ªå…ˆåº¦ï¼šä½ï¼ˆå°†æ¥å¯¾å¿œï¼‰

| ã‚¿ã‚¹ã‚¯ | å†…å®¹ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|--------|------|------------|
| ç®¡ç†UIæ§‹ç¯‰ | Vercel + Next.jsï¼ˆGrafana Cloudã§ååˆ†ãªã‚‰ä¸è¦ï¼‰ | ä¿ç•™ |
| å·®åˆ†åŒæœŸ | sinceãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã‚ˆã‚‹å¢—åˆ†åŒæœŸ | æœªç€æ‰‹ |
| Fitbitè¿½åŠ ãƒ‡ãƒ¼ã‚¿ | Breathing Rate, Cardio Score, Temperature Skin | æœªç€æ‰‹ |
| Tanitaè¿½åŠ ãƒ‡ãƒ¼ã‚¿ | æ­©æ•°ãƒ‡ãƒ¼ã‚¿ï¼ˆpedometerï¼‰ | æœªç€æ‰‹ |

---

## 12. å‚è€ƒè³‡æ–™

### 12.1 å¤–éƒ¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

| ã‚µãƒ¼ãƒ“ã‚¹ | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ |
|---------|------------|
| Toggl Track | [API v9](https://developers.track.toggl.com/docs/) |
| Google Calendar | [API v3](https://developers.google.com/calendar/api) |
| Zaim | [API v2](https://dev.zaim.net/) |
| Fitbit | [Web API](https://dev.fitbit.com/build/reference/web-api/) |
| Tanita | [Health Planet API](https://www.healthplanet.jp/apis/api.html) |

### 12.2 å†…éƒ¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | ãƒ‘ã‚¹ |
|------------|------|
| åŸºæœ¬è¨­è¨ˆæ›¸ï¼ˆæœ¬æ›¸ï¼‰ | `docs/DESIGN.md` |
| Togglè©³ç´°è¨­è¨ˆ | `docs/Detailed_Design/toggl.md` |
| GCalendarè©³ç´°è¨­è¨ˆ | `docs/Detailed_Design/gcalendar.md` |
| Zaimè©³ç´°è¨­è¨ˆ | `docs/Detailed_Design/zaim.md` |
| Fitbitè©³ç´°è¨­è¨ˆ | `docs/Detailed_Design/fitbit.md` |
| Tanitaè©³ç´°è¨­è¨ˆ | `docs/Detailed_Design/tanita.md` |
| DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | `supabase/migrations/` |
| ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ | `tests/pipelines/` |

---

## å¤‰æ›´å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ |
|-----------|------|---------|
| 1.0.0 | 2024-11 | åˆç‰ˆä½œæˆ |
| 1.5.0 | 2025-11 | Toggl Pythonå®Ÿè£…å®Œäº† |
| 2.0.0 | 2025-12-01 | å…¨ã‚µãƒ¼ãƒ“ã‚¹Pythonå®Ÿè£…å®Œäº†ã€è©³ç´°è¨­è¨ˆæ›¸ã¨æ•´åˆæ€§ã‚’å–ã‚Šå†æ§‹æˆ |

---

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆçµ‚äº†**
