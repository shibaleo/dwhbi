# LIFETRACER è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€æœªå®Ÿè£…ã®æ©Ÿèƒ½ã‚„å°†æ¥ã®è¨­è¨ˆæ–¹é‡ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚

## ç›®æ¬¡

- [DWH 4å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#dwh-4å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
- [refã‚¹ã‚­ãƒ¼ãƒã¨Airtable](#refã‚¹ã‚­ãƒ¼ãƒã¨airtable)
- [é…å¸ƒè¨­è¨ˆ](#é…å¸ƒè¨­è¨ˆ)
- [TODOï¼ˆå„ªå…ˆåº¦é †ï¼‰](#todoå„ªå…ˆåº¦é †)
- [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆäºˆå®š](#ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆäºˆå®š)

---

## DWH 4å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ç›®æ¨™æ§‹é€ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ marts.*                                                             â”‚
â”‚   åˆ†æãƒ»é›†è¨ˆãƒ“ãƒ¥ãƒ¼                                                  â”‚
â”‚   agg_daily_health, agg_weekly_productivity                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–²
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ core.*                                                              â”‚
â”‚   ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆæ¸ˆã¿ãƒ“ã‚¸ãƒã‚¹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼ˆã‚µãƒ¼ãƒ“ã‚¹åãŒæ¶ˆãˆã‚‹ï¼‰        â”‚
â”‚   fct_time_entries, fct_transactions, dim_categories                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–²
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ staging.*                                                           â”‚
â”‚   ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ãƒ»æ­£è¦åŒ–æ¸ˆã¿ï¼ˆãƒ“ãƒ¥ãƒ¼ï¼‰                                â”‚
â”‚   stg_toggl__entries, stg_zaim__transactions                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–²
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ raw.*                                                               â”‚
â”‚   å¤–éƒ¨APIã‹ã‚‰ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰                                 â”‚
â”‚   toggl_entries, zaim_transactions, fitbit_sleep                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¨­è¨ˆæ€æƒ³

| å±¤ | å½¹å‰² | ã‚µãƒ¼ãƒ“ã‚¹å | å½¢å¼ |
|----|------|-----------|------|
| raw | APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãã®ã¾ã¾ä¿å­˜ | ã‚ã‚Š | ãƒ†ãƒ¼ãƒ–ãƒ« |
| staging | å‹å¤‰æ›ã€åˆ—åæ­£è¦åŒ–ã€ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¤‰æ› | ã‚ã‚Š | ãƒ“ãƒ¥ãƒ¼ |
| core | è¤‡æ•°ã‚µãƒ¼ãƒ“ã‚¹ã®çµ±åˆã€ãƒ“ã‚¸ãƒã‚¹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£åŒ– | **ãªã—** | ãƒ“ãƒ¥ãƒ¼ |
| marts | åˆ†æãƒ»é›†è¨ˆã€ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¥ãƒ“ãƒ¥ãƒ¼ | ãªã— | ãƒ“ãƒ¥ãƒ¼ |

### ã‚µãƒ¼ãƒ“ã‚¹éä¾å­˜ã®è¨­è¨ˆ

coreå±¤ä»¥é™ã§ã¯ã‚µãƒ¼ãƒ“ã‚¹åãŒæ¶ˆãˆã‚‹ã€‚ã“ã‚Œã«ã‚ˆã‚Šï¼š
- å°†æ¥Togglã‹ã‚‰åˆ¥ã‚µãƒ¼ãƒ“ã‚¹ã«ç§»è¡Œã—ã¦ã‚‚ã€core/martså±¤ã¯å¤‰æ›´ä¸è¦
- åˆ†æã‚¯ã‚¨ãƒªã¯ `fct_time_entries` ã‚’å‚ç…§ã—ã€ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’æ„è­˜ã—ãªã„
- stagingå±¤ã§æ–°æ—§ã‚µãƒ¼ãƒ“ã‚¹ã‚’çµ±åˆã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å¸å

### å‘½åè¦å‰‡

| å±¤ | ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ | ä¾‹ |
|----|---------------|----|
| staging | `stg_{service}__{entity}` | stg_toggl__entries |
| core | `fct_` / `dim_` | fct_time_entries, dim_projects |
| marts | `agg_` / ãƒ‰ãƒ¡ã‚¤ãƒ³å | agg_daily_health |

---

## refã‚¹ã‚­ãƒ¼ãƒã¨Airtable

### å½¹å‰²åˆ†æ‹…

| ã‚¹ã‚­ãƒ¼ãƒ/ã‚µãƒ¼ãƒ“ã‚¹ | å½¹å‰² | åŒæœŸæ–¹å‘ |
|------------------|------|----------|
| Airtable | ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ç·¨é›†UI | - |
| ref.* | ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ | Airtable â†’ ref |
| core.dim_* | ãƒã‚¹ã‚¿ã®çµ±åˆãƒ“ãƒ¥ãƒ¼ | ref â†’ coreï¼ˆãƒ“ãƒ¥ãƒ¼å‚ç…§ï¼‰ |

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
Airtableï¼ˆç·¨é›†UIã€ç„¡æ–™æ 1,000ä»¶/baseï¼‰
    â†“ syncï¼ˆAirtable APIï¼‰
ref.expense_categoriesï¼ˆSupabaseã€æ°¸ç¶šåŒ–ï¼‰
    â†“ view
core.dim_expense_categories
```

### è¨­è¨ˆæ„å›³

- **Airtable**: ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œã€å‹å¼·åˆ¶ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’æŒã¤ç·¨é›†UI
- **ref**: Supabaseå†…ã§ã®ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–å±¤
- **ç„¡æ–™æ 1,000ä»¶ã®åˆ¶ç´„**: ãƒã‚¹ã‚¿å°‚ç”¨ã¨ã„ã†å½¹å‰²ã‚’ç‰©ç†çš„ã«å¼·åˆ¶ï¼ˆåˆ†æå¯¾è±¡ã«ã¯ãªã‚‰ãªã„ï¼‰

### Notionã¨ã®ä½¿ã„åˆ†ã‘

| ã‚µãƒ¼ãƒ“ã‚¹ | ç”¨é€” | ã‚¹ã‚­ãƒ¼ãƒ |
|---------|------|----------|
| Airtable | ãƒã‚¹ã‚¿ç·¨é›†UIï¼ˆé™çš„ã€å¢—ãˆãªã„ï¼‰ | ref.* |
| Notion | åˆ†æå¯¾è±¡ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ï¼ˆæ™‚ç³»åˆ—ã§å¢—ãˆã‚‹ï¼‰ | raw.* |

### âš ï¸ åŒæ–¹å‘åŒæœŸã®æ³¨æ„ç‚¹

ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆä¾‹: Togglãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ â†’ ã‚«ãƒ†ã‚´ãƒªï¼‰ã‚’ä½œæˆã™ã‚‹å ´åˆã€IDã®ç®¡ç†ãŒå¿…è¦ï¼š

```
1. Supabaseã§ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆæ™‚ã«IDãŒç”Ÿæˆã•ã‚Œã‚‹
2. ãã®IDã‚’Airtableã«åŒæœŸã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ˆSupabase â†’ Airtableï¼‰
3. Airtableå´ã§ã®ç·¨é›†ã¯Airtable â†’ Supabaseã§åŒæœŸ
```

åŒæœŸãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š
- **é€šå¸¸ã®ãƒã‚¹ã‚¿**: Airtable â†’ refï¼ˆä¸€æ–¹å‘ï¼‰
- **IDã‚’å«ã‚€ãƒãƒƒãƒ”ãƒ³ã‚°**: åˆå›ã¯ref â†’ Airtableã€ä»¥é™ã¯Airtable â†’ ref

IDç«¶åˆã‚’é¿ã‘ã‚‹ãŸã‚ã€Airtableå´ã§ã¯Supabaseã®IDã‚’ç·¨é›†ä¸å¯ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦è¡¨ç¤ºã™ã‚‹è¨­è¨ˆã‚’æ¨å¥¨ã€‚

---

## é…å¸ƒè¨­è¨ˆ

### è¨­è¨ˆå“²å­¦

**ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæä¾›ã«å¾¹ã™ã‚‹**

- ä»–äººã®ã‚¢ãƒ—ãƒªã‚’ç®¡ç†ã—ãªã„
- ãƒªãƒã‚¸ãƒˆãƒªã¯çªç„¶æ¶ˆãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
- å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒçœŸã®æ„å‘³ã§ä¸»å°æ¨©ã‚’æŒã¤

**60å¹´é‹ç”¨ã®æ€æƒ³ã¨ä¸€è²«**

å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¨ãƒªã‚½ãƒ¼ã‚¹ã‚’æ‰€æœ‰ã—ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæä¾›è€…ï¼ˆç§ï¼‰ã¸ã®ä¾å­˜ãªãé‹ç”¨ã§ãã‚‹ã“ã¨ã€‚

```
ç§ â”€â”€â”€â”€æä¾›â”€â”€â”€â”€â†’ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
                    â†“ fork
ãƒ¦ãƒ¼ã‚¶ãƒ¼ â”€æ‰€æœ‰â”€â†’ å…¨ãƒªã‚½ãƒ¼ã‚¹

ç§ã®ãƒªãƒã‚¸ãƒˆãƒªãŒæ¶ˆãˆã¦ã‚‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚·ã‚¹ãƒ†ãƒ ã¯å‹•ãç¶šã‘ã‚‹
```

### æœ€å°æ§‹æˆï¼ˆ2ã‚µãƒ¼ãƒ“ã‚¹ï¼‰

| ã‚µãƒ¼ãƒ“ã‚¹ | å½¹å‰² | ç„¡æ–™æ  |
|---------|------|--------|
| **GitHub** | ã‚³ãƒ¼ãƒ‰ã€Actionsï¼ˆåŒæœŸã‚¸ãƒ§ãƒ–ï¼‰ã€Pagesï¼ˆç®¡ç†UIï¼‰ | Actions 2000åˆ†/æœˆ |
| **Supabase** | PostgreSQLã€èªè¨¼æƒ…å ±ä¿å­˜ | DB 500MB |

```
GitHub
â”œâ”€â”€ Private Repository
â”œâ”€â”€ Secretsï¼ˆclient_secretã€ENCRYPTION_KEYä¿å­˜ï¼‰
â”œâ”€â”€ Actionsï¼ˆãƒ“ãƒ«ãƒ‰ + åŒæœŸã‚¸ãƒ§ãƒ–ï¼‰
â””â”€â”€ Pagesï¼ˆç®¡ç†UIã€secretæ³¨å…¥æ¸ˆã¿ï¼‰

Supabase
â””â”€â”€ PostgreSQLï¼ˆãƒ‡ãƒ¼ã‚¿ + æš—å·åŒ–tokenï¼‰
```

### ç®¡ç†UIè¨­è¨ˆ

**GitHub Pages + ãƒ“ãƒ«ãƒ‰æ™‚secretæ³¨å…¥**

```
1. client_secretã¯GitHub Secretsã«ä¿å­˜
2. GitHub Actionsã§Pagesç”¨JSã‚’ãƒ“ãƒ«ãƒ‰
3. ãƒ“ãƒ«ãƒ‰æ™‚ã«ç’°å¢ƒå¤‰æ•°ã‚’æ³¨å…¥
4. ç”Ÿæˆã•ã‚ŒãŸJSã«client_secretãŒå«ã¾ã‚Œã‚‹
5. GitHub Pagesã§é…ä¿¡
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•**

| è¦³ç‚¹ | è©•ä¾¡ |
|------|------|
| æ­£çµ±ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ | âœ— client_secretãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«éœ²å‡º |
| å®Ÿè³ªçš„ãªãƒªã‚¹ã‚¯ | â–³ URLã‚’çŸ¥ã‚‰ãªã‘ã‚Œã°ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œãªã„ |
| è¢«å®³ã®æ·±åˆ»åº¦ | ä½ï¼ˆé‡‘éŠ­è¢«å®³ãªã—ã€ãƒ‡ãƒ¼ã‚¿é–²è¦§ã®ã¿ï¼‰ |
| ã‚·ãƒ³ãƒ—ãƒ«ã• | â— Edge Functionsä¸è¦ |

â†’ è¦ªã—ã„äººå‘ã‘ãƒ»è‡ªå·±è²¬ä»»ã§ä½¿ã†ãªã‚‰è¨±å®¹ç¯„å›²

### ãƒ„ãƒ¼ãƒ«ã®å½¹å‰²åˆ†æ‹…

| ãƒ„ãƒ¼ãƒ« | å½¹å‰² | é »åº¦ |
|--------|------|------|
| ç®¡ç†UIï¼ˆGitHub Pagesï¼‰ | èªè¨¼ç®¡ç†ã€OAuthå†èªè¨¼ã€å¾©æ—§ä½œæ¥­ | æœˆæ•°å› |
| Airtable | ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ç·¨é›† | é †æ™‚ |
| Grafana Cloud | åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€å¯è¦–åŒ– | æ—¥å¸¸çš„ |

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç®¡ç†UI          â”‚     â”‚  Airtable        â”‚     â”‚  Grafana Cloud   â”‚
â”‚  - OAuthå†èªè¨¼   â”‚     â”‚  - ãƒã‚¹ã‚¿ç·¨é›†    â”‚     â”‚  - æ™‚é–“åˆ†æ      â”‚
â”‚  - ãƒˆãƒ¼ã‚¯ãƒ³å¾©æ—§  â”‚     â”‚  - ã‚«ãƒ†ã‚´ãƒªç®¡ç†  â”‚     â”‚  - æ”¯å‡ºæ¨ç§»      â”‚
â”‚  ï¼ˆä½é »åº¦ï¼‰      â”‚     â”‚  ï¼ˆé †æ™‚ï¼‰        â”‚     â”‚  - å¥åº·æŒ‡æ¨™      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                        â”‚                        â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚   Supabase    â”‚
               â”‚   PostgreSQL  â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ•ãƒ­ãƒ¼

**åˆæœŸè¨­å®šï¼ˆ1å›ã€æ‰‹å‹•ï¼‰**

```
1. GitHubã€ŒUse this templateã€ã§ãƒªãƒã‚¸ãƒˆãƒªä½œæˆï¼ˆPrivateï¼‰
2. Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
3. å„ã‚µãƒ¼ãƒ“ã‚¹ã§OAuthã‚¢ãƒ—ãƒªç™»éŒ²
   - callback URI: https://{username}.github.io/{repo}/callback/{service}
4. GitHub Secretsã«è¨­å®š
   - client_id / client_secretï¼ˆå„ã‚µãƒ¼ãƒ“ã‚¹ï¼‰
   - SUPABASE_URL / SUPABASE_SERVICE_ROLE_KEY
   - TOKEN_ENCRYPTION_KEY
5. GitHub Pagesæœ‰åŠ¹åŒ–ï¼ˆSettings â†’ Pagesï¼‰
6. supabase db push ã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨
```

**æ—¥å¸¸é‹ç”¨ï¼ˆãƒœã‚¿ãƒ³1ã¤ï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç®¡ç†UI                                 â”‚
â”‚                                         â”‚
â”‚  [Fitbitã‚’é€£æº]  [Tanitaã‚’é€£æº]  ...    â”‚
â”‚       â†“                                 â”‚
â”‚  OAuthç”»é¢ â†’ è¨±å¯ â†’ è‡ªå‹•ä¿å­˜ â†’ å®Œäº†     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**éšœå®³æ™‚**

- ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™åˆ‡ã‚Œ â†’ ã€Œå†é€£æºã€ãƒœã‚¿ãƒ³æŠ¼ã™ã ã‘
- ã‚ˆãã‚ã‹ã‚‰ãªã„ã‚¨ãƒ©ãƒ¼ â†’ æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã—

ã€Œç›´ã™ã€ã‚ˆã‚Šã€Œä½œã‚Šç›´ã™ã€ã®ã»ã†ãŒéã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ã¯åˆ†ã‹ã‚Šã‚„ã™ã„ã€‚

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè²¬ä»»ã®åˆ†é›¢

| é …ç›® | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ |
|------|-------------|
| GitHub PAT | GitHubå…¬å¼ï¼ˆè†¨å¤§ã€å¤šè¨€èªå¯¾å¿œï¼‰ |
| Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ | Supabaseå…¬å¼ |
| å„ã‚µãƒ¼ãƒ“ã‚¹OAuthç™»éŒ² | å„ã‚µãƒ¼ãƒ“ã‚¹å…¬å¼ + è‡ªå‰ã§æœ€ä½é™ï¼ˆcallback URIã€ã‚¹ã‚³ãƒ¼ãƒ—ä¸€è¦§ï¼‰ |
| ç®¡ç†UIã®ä½¿ã„æ–¹ | è‡ªå‰ï¼ˆç›´æ„Ÿçš„ãªUIã‚’ç›®æŒ‡ã™ï¼‰ |

### èªè¨¼æƒ…å ±ã®éšå±¤æ§‹é€ 

```
GitHub PATï¼ˆæ‰‹å‹•ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§ï¼‰
    â”‚
    â”œâ”€â†’ GitHub Secrets è¨­å®š
    â”‚       â”œâ”€â”€ SUPABASE_URL
    â”‚       â”œâ”€â”€ SUPABASE_SERVICE_ROLE_KEY
    â”‚       â”œâ”€â”€ TOKEN_ENCRYPTION_KEY
    â”‚       â””â”€â”€ å„ã‚µãƒ¼ãƒ“ã‚¹ã®client_id / client_secret
    â”‚
    â””â”€â†’ GitHub Actions å®Ÿè¡Œ
            â”‚
            â–¼
        Supabase credentials.services
            â”œâ”€â”€ Fitbit tokens
            â”œâ”€â”€ Tanita tokens
            â”œâ”€â”€ Toggl credentials
            â”œâ”€â”€ Zaim credentials
            â””â”€â”€ etc.
```

---

## TODOï¼ˆå„ªå…ˆåº¦é †ï¼‰

### ğŸ”´ ç·Šæ€¥åº¦ï¼šé«˜ï¼ˆé‹ç”¨åœæ­¢ãƒªã‚¹ã‚¯ï¼‰

| ã‚¿ã‚¹ã‚¯ | å†…å®¹ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|--------|------|------------|
| ENCRYPTION KEYå¾©æ—§æ‰‹é † | ç´›å¤±æ™‚ã®èªè¨¼æƒ…å ±å†è¨­å®šãƒ•ãƒ­ãƒ¼ã€å…¨ã‚µãƒ¼ãƒ“ã‚¹ã®å†èªè¨¼æ‰‹é † | æœªç€æ‰‹ |
| OAuthå†èªè¨¼æ‰‹é † | ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³å¤±åŠ¹æ™‚ã®æ‰‹å‹•å†èªè¨¼ãƒ•ãƒ­ãƒ¼ï¼ˆFitbit, Tanita, Zaimï¼‰ | æœªç€æ‰‹ |
| Phase 6: åŒæœŸãƒ†ã‚¹ãƒˆ | sync_daily.ts ã®å‹•ä½œç¢ºèª | æœªç€æ‰‹ |
| Phase 7: .envæ•´ç† | SUPABASE_* ã¨ TOKEN_ENCRYPTION_KEY ä»¥å¤–ã‚’å‰Šé™¤ | æœªç€æ‰‹ |

### ğŸŸ  å„ªå…ˆåº¦ï¼šé«˜ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»é‹ç”¨åŸºç›¤ï¼‰

| ã‚¿ã‚¹ã‚¯ | å†…å®¹ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|--------|------|------------|
| å„ã‚µãƒ¼ãƒ“ã‚¹æ¥ç¶šãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | APIç™»éŒ²ã€OAuthè¨­å®šã€credentials.services ã¸ã®åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥æ‰‹é † | æœªç€æ‰‹ |
| ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»ãƒªã‚¹ãƒˆã‚¢æ‰‹é † | Supabaseãƒ‡ãƒ¼ã‚¿ã®å®šæœŸã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€pg_dump/restoreæ‰‹é † | æœªç€æ‰‹ |
| ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— | æ–°PC/æ–°ç’°å¢ƒã§ã®æ§‹ç¯‰æ‰‹é †ã€å¿…è¦ãªãƒ„ãƒ¼ãƒ«ä¸€è¦§ | æœªç€æ‰‹ |
| Phase 8: æ—§tokenså‰Šé™¤ | fitbit.tokens, tanita.tokens ãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤ | æœªç€æ‰‹ |

### ğŸŸ¡ å„ªå…ˆåº¦ï¼šä¸­ï¼ˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ»å“è³ªï¼‰

| ã‚¿ã‚¹ã‚¯ | å†…å®¹ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|--------|------|------------|
| Phase 9: DWH 4å±¤æ§‹ç¯‰ | staging/core/martså±¤ã®ãƒ“ãƒ¥ãƒ¼ä½œæˆ | æœªç€æ‰‹ |
| ç®¡ç†UIæ§‹ç¯‰ | GitHub Pages + ãƒ“ãƒ«ãƒ‰æ™‚secretæ³¨å…¥ã€OAuthãƒ•ãƒ­ãƒ¼å®Ÿè£… | æœªç€æ‰‹ |
| Airtableé€£æº | refã‚¹ã‚­ãƒ¼ãƒã¨ã®åŒæœŸã€ãƒã‚¹ã‚¿ç·¨é›†UI | æœªç€æ‰‹ |
| Grafana Cloudé€£æº | PostgreSQLãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹è¨­å®šã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä½œæˆ | æœªç€æ‰‹ |
| ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†æ–¹é‡ | ä¿ç®¡å ´æ‰€ã€å‘½åè¦å‰‡ã€ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é † | æœªç€æ‰‹ |
| åŒæœŸå¤±æ•—ã‚¢ãƒ©ãƒ¼ãƒˆ | GitHub Actionså¤±æ•—æ™‚ã®Slack/ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ | æœªç€æ‰‹ |
| æ–°ã‚µãƒ¼ãƒ“ã‚¹è¿½åŠ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ | ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰ã€ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ | æœªç€æ‰‹ |
| ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´æ‰‹é † | æ–°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ æ™‚ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ãƒ­ãƒ¼ | æœªç€æ‰‹ |
| æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ã‚¯ã‚¨ãƒª | rawâ†”stagingâ†”coreã®ä»¶æ•°ãƒ»æ¬ æç¢ºèªSQL | æœªç€æ‰‹ |

### ğŸŸ¢ å„ªå…ˆåº¦ï¼šä½ï¼ˆè€éšœå®³æ€§ãƒ»å°†æ¥å¯¾å¿œï¼‰

| ã‚¿ã‚¹ã‚¯ | å†…å®¹ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|--------|------|------------|
| Supabaseçµ‚äº†æ™‚ã®ç§»è¡Œè¨ˆç”» | PostgreSQLã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€åˆ¥ãƒ›ã‚¹ãƒˆã¸ã®ç§»è¡Œæ‰‹é † | æœªç€æ‰‹ |
| å„ã‚µãƒ¼ãƒ“ã‚¹APIå»ƒæ­¢æ™‚ã®å¯¾å¿œ | ãƒ‡ãƒ¼ã‚¿ä¿å…¨æ–¹é‡ã€ä»£æ›¿ã‚µãƒ¼ãƒ“ã‚¹é¸å®šåŸºæº– | æœªç€æ‰‹ |
| Airtableçµ‚äº†æ™‚ã®ä»£æ›¿ | refå±¤UIã®ç§»è¡Œå…ˆå€™è£œï¼ˆNocoDBç­‰ï¼‰ | æœªç€æ‰‹ |
| é‡è¤‡æ¤œçŸ¥ã‚¯ã‚¨ãƒª | åŒæœŸãƒŸã‚¹ã«ã‚ˆã‚‹é‡è¤‡ãƒ¬ã‚³ãƒ¼ãƒ‰ã®æ¤œå‡ºãƒ»ä¿®æ­£SQL | æœªç€æ‰‹ |

---

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆäºˆå®š

```
docs/
â”œâ”€â”€ SETUP.md                    # ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
â”œâ”€â”€ USER_SETUP.md               # ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåˆ©ç”¨è€…ç”¨ï¼‰
â”œâ”€â”€ SERVICE_CONNECTION.md       # å„ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®æ¥ç¶šæ–¹æ³•ï¼ˆOAuthã‚¢ãƒ—ãƒªç™»éŒ²ã€callback URIè¨­å®šï¼‰
â”œâ”€â”€ ENCRYPTION_KEY_RECOVERY.md  # ENCRYPTION KEYå¾©æ—§æ‰‹é †
â”œâ”€â”€ OAUTH_REAUTH.md             # OAuthå†èªè¨¼æ‰‹é †
â”œâ”€â”€ BACKUP_RESTORE.md           # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»ãƒªã‚¹ãƒˆã‚¢æ‰‹é †
â”œâ”€â”€ MIGRATION_POLICY.md         # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†æ–¹é‡
â”œâ”€â”€ NEW_SERVICE_GUIDE.md        # æ–°ã‚µãƒ¼ãƒ“ã‚¹è¿½åŠ ã‚¬ã‚¤ãƒ‰
â””â”€â”€ DISASTER_RECOVERY.md        # éšœå®³å¾©æ—§è¨ˆç”»
```

## é…å¸ƒè¨­è¨ˆ (Revised: Security-First Approach)

### 1. è¨­è¨ˆå“²å­¦ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæä¾›ã«å¾¹ã™ã‚‹ï¼‰

* **åŸºæœ¬æ–¹é‡:** LIFETRACERã¯ã€**60å¹´é‹ç”¨ã®æ€æƒ³**ã«åŸºã¥ãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¨ã¦ã®æ¨©é™ã¨ãƒªã‚½ãƒ¼ã‚¹ã‚’æ‰€æœ‰ã™ã‚‹**ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆé…å¸ƒç‰©ï¼‰**ã¨ã—ã¦æä¾›ã•ã‚Œã‚‹ã€‚
* **æœ€å°æ§‹æˆ:** **GitHub (ãƒªãƒã‚¸ãƒˆãƒª/Pages/Actions)** ã¨ **Supabase (DB/Auth/Edge Functions)** ã®2ã‚µãƒ¼ãƒ“ã‚¹æ§‹æˆã‚’ç¶­æŒã™ã‚‹ã€‚

### 2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£èª²é¡Œã®è§£æ±ºï¼ˆClient Secretã®éš”é›¢ï¼‰

å…ƒã®è¨­è¨ˆã«ãŠã‘ã‚‹æœ€å¤§ã®èª²é¡Œã¯ã€OAuthé€£æºã«å¿…è¦ãª **Client Secret** ãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ï¼ˆGitHub Pagesã§é…ä¿¡ã•ã‚Œã‚‹JavaScriptï¼‰ã«éœ²å‡ºã™ã‚‹ç‚¹ã§ã‚ã£ãŸã€‚ã“ã‚Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®æ§‹æˆã‚’æ¡ç”¨ã™ã‚‹ã€‚

* **æ©Ÿå¯†æƒ…å ±ã®éš”é›¢:**
    * **Client Secret** ã¯ã€Supabase DBå†…ã®å°‚ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆ`ref.secrets`ï¼‰ã«ã®ã¿ä¿å­˜ã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã«ã¯ä¸€åˆ‡éœ²å‡ºã•ã›ãªã„ã€‚
    * ã“ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ã€Supabaseã®**ã‚µãƒ¼ãƒ“ã‚¹ãƒ­ãƒ¼ãƒ«ã‚­ãƒ¼**ã‚’æŒã¤**ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**ï¼ˆEdge Functions ãŠã‚ˆã³ GitHub Actionsï¼‰ã«é™å®šã™ã‚‹ã€‚
* **èªè¨¼ãƒ»åŒæœŸå‡¦ç†ã®åˆ†æ‹…:**
    * **åˆå›ãƒˆãƒ¼ã‚¯ãƒ³äº¤æ›ï¼ˆèªè¨¼æ™‚ï¼‰:** **Supabase Edge Functions**ãŒå®Ÿè¡Œã™ã‚‹ã€‚FunctionsãŒDBã‹ã‚‰ Secret ã‚’å®‰å…¨ã«èª­ã¿å‡ºã—ã€ãƒˆãƒ¼ã‚¯ãƒ³äº¤æ›å‡¦ç†ã‚’è¡Œã„ã€å–å¾—ã—ãŸãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆæš—å·åŒ–æ¸ˆã¿ï¼‰ã‚’DBã«ä¿å­˜ã™ã‚‹ã€‚
    * **ç¶™ç¶šçš„ãƒ‡ãƒ¼ã‚¿åŒæœŸï¼ˆé‹ç”¨æ™‚ï¼‰:** **GitHub Actions**ãŒå®Ÿè¡Œã™ã‚‹ã€‚ActionsãŒDBã‹ã‚‰ Secret ãŠã‚ˆã³ Refresh Token ã‚’å®‰å…¨ã«èª­ã¿å‡ºã—ã€ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã¨ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’è¡Œã†ã€‚

### 3. ç®¡ç†UIã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã¨åˆå›è¨­å®šã®ç°¡ç•¥åŒ–

åˆ©ç”¨è€…ï¼ç®¡ç†è€…ã§ã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åˆ©ä¾¿æ€§ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ä¸¡ç«‹ã•ã›ã‚‹ãŸã‚ã€ç®¡ç†UIï¼ˆGitHub Pagesï¼‰ã«**Supabase Auth**ã«ã‚ˆã‚‹èªè¨¼æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹ã€‚

| æ©Ÿèƒ½ | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | å®Ÿç¾å†…å®¹ |
| :--- | :--- | :--- |
| **ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™** | **Supabase Auth / GitHub Pages** | ç®¡ç†UIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ã€Supabaseã«ç™»éŒ²ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ‰€æœ‰è€…ï¼‰ã®ã¿ã«é™å®šã™ã‚‹ã€‚URLç›´æ‰“ã¡ã«ã‚ˆã‚‹ç¬¬ä¸‰è€…ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²ãã€‚ |
| **å®‰å…¨ãªSecretå…¥åŠ›** | **Edge Functions / Supabase DB** | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ­ã‚°ã‚¤ãƒ³å¾Œã€ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã®ç®¡ç†UIã§Client Secretã‚’ä¸€åº¦ã ã‘å…¥åŠ›ã§ãã‚‹ã€‚ã“ã®æƒ…å ±ã¯ã€**èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®JWT**ã¨å…±ã« **HTTPSé€šä¿¡** ã§ **Edge Function** ã«é€ä¿¡ã•ã‚Œã€**DB**ã«å®‰å…¨ã«ä¿å­˜ã•ã‚Œã‚‹ã€‚ |

### 4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ•ãƒ­ãƒ¼ï¼ˆClient Secretå…¥åŠ›å«ã‚€ï¼‰

1.  GitHubã§ãƒªãƒã‚¸ãƒˆãƒªä½œæˆã€Pagesæœ‰åŠ¹åŒ–ã€‚
2.  Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã€ã‚¹ã‚­ãƒ¼ãƒï¼ˆ`ref.secrets`å«ã‚€ï¼‰ã¨**Edge Functions**ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã€‚
3.  Supabase Authã§ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç™»éŒ²ã€‚
4.  Fitbitãªã©ã®OAuthã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã€**Callback URI**ã‚’**ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸEdge Functionã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**ã«è¨­å®šã€‚
5.  GitHub Pagesã®ç®¡ç†UIã¸**ãƒ­ã‚°ã‚¤ãƒ³**ï¼ˆSupabase Authåˆ©ç”¨ï¼‰ã€‚
6.  ãƒ­ã‚°ã‚¤ãƒ³å¾Œã€ç®¡ç†UIã®ãƒ•ã‚©ãƒ¼ãƒ ã«**Client IDã¨Client Secret**ã‚’å…¥åŠ›ãƒ»é€ä¿¡ã€‚
7.  Edge FunctionãŒ**èªè¨¼æ¸ˆã¿ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**ã‚’ç¢ºèªå¾Œã€DBã® `ref.secrets` ã«Client Secretã‚’å®‰å…¨ã«ä¿å­˜ã™ã‚‹ã€‚

### 5. å°†æ¥çš„ãªãƒ‡ãƒ¼ã‚¿å…¬é–‹ã¸ã®å¯¾å¿œ

Supabase Authã¨RLSï¼ˆRow Level Securityï¼‰ã‚’æœ€å¤§é™æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€å°†æ¥çš„ãªãƒ‡ãƒ¼ã‚¿å…¬é–‹ã«ã‚‚å¯¾å¿œã§ãã‚‹ã€‚

* **ç®¡ç†è€…èªè¨¼:** ç¾åœ¨ã®è¨­è¨ˆé€šã‚Šã€ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã¨ã—ã¦ã®ç®¡ç†UIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶å¾¡ã€‚
* **ãƒ“ãƒ¥ãƒ¼ã‚¢èªè¨¼:** ãƒ‡ãƒ¼ã‚¿å…¬é–‹ç”¨ã®**åˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**ã‚’Supabase Authã§ç®¡ç†ã—ã€**`marts` ã‚¹ã‚­ãƒ¼ãƒ**ã®ãƒ“ãƒ¥ãƒ¼ã«å¯¾ã—ã¦ã€Œèªè¨¼æ¸ˆã¿ãƒ“ãƒ¥ãƒ¼ã‚¢ã¯é–²è¦§ã®ã¿å¯èƒ½ã€ã¨ã„ã£ãŸ**ãã‚ç´°ã‚„ã‹ãªã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**ã‚’RLSã§é©ç”¨ã™ã‚‹ã€‚

---

## TODOï¼ˆå„ªå…ˆåº¦é †ï¼‰

### ğŸ”´ å„ªå…ˆåº¦ï¼šé«˜ï¼ˆãƒªãƒªãƒ¼ã‚¹å¿…é ˆï¼‰

| ã‚¿ã‚¹ã‚¯ | å†…å®¹ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|--------|------|------------|
| OAuthå†èªè¨¼æ‰‹é † | ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™åˆ‡ã‚Œãƒ»å¤±åŠ¹æ™‚ã®ãƒªã‚«ãƒãƒªæ‰‹é † | **è¦‹ç›´ã—ä¸­** (Edge Functionsåˆ©ç”¨å‰æã§å†è¨­è¨ˆ) |
| ENCRYPTION KEYå¾©æ—§æ‰‹é † | ãƒˆãƒ¼ã‚¯ãƒ³æš—å·åŒ–ã‚­ãƒ¼ç´›å¤±æ™‚ã®ãƒªã‚«ãƒãƒªæ‰‹é † | æœªç€æ‰‹ |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ç‰ˆç®¡ç†UI** | **GitHub Pagesã¸ã®Supabase Authãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã¨ã€èªè¨¼æ¸ˆã¿Edge FunctionçµŒç”±ã§ã®Client Secretç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã®å®Ÿè£…** | **è¨­è¨ˆå®Œäº†** (å®Ÿè£…å‰) |
| **Edge Functionã®å®Ÿè£…** | **åˆå›OAuthãƒˆãƒ¼ã‚¯ãƒ³äº¤æ›ã€èªè¨¼æ¸ˆã¿Client Secretç™»éŒ²APIã®å®Ÿè£…** | **è¨­è¨ˆå®Œäº†** (å®Ÿè£…å‰) |
| åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥æ‰‹é † | æœªç€æ‰‹ |
| ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»ãƒªã‚¹ãƒˆã‚¢æ‰‹é † | Supabaseãƒ‡ãƒ¼ã‚¿ã®å®šæœŸã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€pg_dump/restoreæ‰‹é † | æœªç€æ‰‹ |
| ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— | æ–°PC/æ–°ç’°å¢ƒã§ã®æ§‹ç¯‰æ‰‹é †ã€å¿…è¦ãªãƒ„ãƒ¼ãƒ«ä¸€è¦§ | æœªç€æ‰‹ |
| Phase 8: æ—§tokenså‰Šé™¤ | fitbit.tokens, tanita.tokens ãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤ | æœªç€æ‰‹ |

### ğŸŸ¡ å„ªå…ˆåº¦ï¼šä¸­ï¼ˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ»å“è³ªï¼‰

| ã‚¿ã‚¹ã‚¯ | å†…å®¹ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|--------|------|------------|
| Phase 9: DWH 4å±¤æ§‹ç¯‰ | staging/core/martså±¤ã®ãƒ“ãƒ¥ãƒ¼ä½œæˆ | æœªç€æ‰‹ |
| ç®¡ç†UIæ§‹ç¯‰ | GitHub Pages + ãƒ“ãƒ«ãƒ‰æ™‚secretæ³¨å…¥ã€OAuthãƒ•ãƒ­ãƒ¼å®Ÿè£… | **ç½®ãæ›ãˆ** (ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ç‰ˆç®¡ç†UIã‚¿ã‚¹ã‚¯ã¸) |
| Airtableé€£æº | refã‚¹ã‚­ãƒ¼ãƒã¨ã®åŒæœŸã€ãƒã‚¹ã‚¿ç·¨é›†UI | æœªç€æ‰‹ |
| Grafana Cloudé€£æº | PostgreSQLãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹è¨­å®šã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä½œæˆ | æœªç€æ‰‹ |
| ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†æ–¹é‡ | ä¿ç®¡å ´æ‰€ã€å‘½åè¦å‰‡ã€ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é † | æœªç€æ‰‹ |
| åŒæœŸå¤±æ•—ã‚¢ãƒ©ãƒ¼ãƒˆ | GitHub Actionså¤±æ•—æ™‚ã®Slack/ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ | æœªç€æ‰‹ |
| æ–°ã‚µãƒ¼ãƒ“ã‚¹è¿½åŠ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ | ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰ã€ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ | æœªç€æ‰‹ |
| ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´æ‰‹é † | æ–°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ æ™‚ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ãƒ­ãƒ¼ | æœªç€æ‰‹ |
| æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ã‚¯ã‚¨ãƒª | rawâ†”stagingâ†”coreã®ä»¶æ•°ãƒ»æ¬ æç¢ºèªSQL | æœªç€æ‰‹ |

### ğŸŸ¢ å„ªå…ˆåº¦ï¼šä½ï¼ˆè€éšœå®³æ€§ãƒ»å°†æ¥å¯¾å¿œï¼‰

| ã‚¿ã‚¹ã‚¯ | å†…å®¹ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|--------|------|------------|
| Supabaseçµ‚äº†æ™‚ã®ç§»è¡Œè¨ˆç”» | PostgreSQLã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ... | æœªç€æ‰‹ |

### ãƒ‡ãƒ—ãƒ­ã‚¤è¨­è¨ˆ

ç®¡ç†ç”»é¢ã¯github pagesã§ã¯ãªãã€vercelã‚’åˆ©ç”¨ã€‚
ç®¡ç†ç”»é¢åˆå›ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«ã¯supabase authã‚’åˆ©ç”¨ã—ã¦èªè¨¼ã‚’è¡Œã†ã€‚
å€‹äººãƒ‡ãƒ¼ã‚¿é…ä¿¡ã®ãŸã‚ã«auth ä¸è¦ãªlanding pageã‚’ä½œæˆã™ã‚‹ã‹å¦ã‹ã®ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ã‚’å®Ÿè£…ã™ã‚‹ã€‚
ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶å‘ã‘ã®ãƒ­ã‚°ã‚¤ãƒ³ã‚‚supabase authã‚’åˆ©ç”¨ã™ã‚‹ã€‚
ãƒˆãƒ¼ã‚¯ãƒ³ã®å…¥åŠ›ã¯ç®¡ç†ç”»é¢ã§è¡Œã„ã€vercel functionsçµŒç”±ã§supabaseã«ä¿å­˜ã™ã‚‹ã€‚
ãŸã ã—ã€ä½¿ã„æ¨ã¦ã®æš—å·åŒ–ã‚­ãƒ¼ã‚’ãã®å ´ã§ä½œæˆã—ã€vercelã®ç’°å¢ƒå¤‰æ•°ã¸è¨­å®šã•ã›ã‚‹ã€‚
supabaseã¸ã¯æš—å·åŒ–ã—ã¦ä¿å­˜ã€‚
æš—å·åŒ–ã‚­ãƒ¼ã‚’ç´›å¤±ã—ãŸå ´åˆã¯ã€å†ç™»éŒ²ãŒå¿…è¦ã€‚
supabase functionsã§oauthã®callbackã‚’å—ã‘å–ã‚Šã€ãƒˆãƒ¼ã‚¯ãƒ³äº¤æ›ã¨supabaseã¸ã®ä¿å­˜ã‚’è¡Œã†ã€‚
ãƒ‡ãƒ¼ã‚¿ã®å¯è¦–åŒ–ã¯grafana cloudã‚’åˆ©ç”¨ã™ã‚‹ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å¯è¦–åŒ–åŸºç›¤ã®ã‚¯ãƒ©ã‚¦ãƒ‰åŒ–ã¨ãƒ‡ãƒ¼ã‚¿ã®å…¬é–‹ç¯„å›²ã®è¨­å®šã‚’å®Ÿç¾ã§ãã‚‹ã€‚
ãã†ãªã‚‹ã¨ç®¡ç†ç”»é¢ã¯ã„ã‚‰ãªã„ã‹ã‚‚ã€‚

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯åˆ·æ–°ï¼ˆDeno â†’ Python + dbtï¼‰

### ç§»è¡Œã®èƒŒæ™¯

ç¾åœ¨Denoã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿åŒæœŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã€Python + dbt ã«ç§»è¡Œã™ã‚‹ã€‚

**ç§»è¡Œç†ç”±:**
1. **ãƒ‡ãƒ¼ã‚¿å¤‰æ›ã®æ¨™æº–åŒ–**: DWH 4å±¤ï¼ˆraw â†’ staging â†’ core â†’ martsï¼‰ã‚’dbtã§å®Ÿè£…
2. **ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã®å……å®Ÿ**: ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°é ˜åŸŸã§ã¯PythonãŒæ¨™æº–
3. **Edge Functions ã®å®Ÿç”¨é€”**: OAuth callbackã®ã¿ï¼ˆSupabaseæ¨™æº–ã®Denoåˆ©ç”¨ï¼‰
4. **ç®¡ç†UIã®æŠ€è¡“é¸å®š**: Vercel + Next.jsï¼ˆNode.jsç’°å¢ƒï¼‰
5. **60å¹´é‹ç”¨æ€æƒ³**: PostgreSQL + Python + dbt ã¯æ¯ã‚ŒãŸæŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

**Denoã®æ®‹å­˜ç®‡æ‰€**: Supabase Edge Functions **ã®ã¿**ï¼ˆOAuthãƒˆãƒ¼ã‚¯ãƒ³äº¤æ›å‡¦ç†ï¼‰

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | æŠ€è¡“ | å®Ÿè¡Œç’°å¢ƒ | ç”¨é€” |
|---------|------|---------|------|
| **APIåŒæœŸ â†’ raw** | Python 3.12+ | GitHub Actions | å¤–éƒ¨APIå‘¼ã³å‡ºã—ã€rawå±¤ã¸ã®æ›¸ãè¾¼ã¿ |
| **raw â†’ staging** | dbt (SQL) | GitHub Actions | å‹å¤‰æ›ã€ã‚«ãƒ©ãƒ æ­£è¦åŒ–ã€ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¤‰æ› |
| **staging â†’ core** | dbt (SQL) | GitHub Actions | ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆã€ãƒ“ã‚¸ãƒã‚¹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£åŒ– |
| **core â†’ marts** | dbt (SQL) | GitHub Actions | åˆ†æé›†è¨ˆã€ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¥ãƒ“ãƒ¥ãƒ¼ |
| **ç®¡ç†UI** | Next.js + Vercel | Vercel Edge | OAuthå†èªè¨¼ã€Client Secretç™»éŒ² |
| **OAuth Callback** | Deno (Edge Functions) | Supabase | ãƒˆãƒ¼ã‚¯ãƒ³äº¤æ›ã€DBä¿å­˜ |
| **å¯è¦–åŒ–** | Grafana Cloud | - | PostgreSQLæ¥ç¶šã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ |

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
External APIs
    â†“ Python (pipelines/)
Supabase raw.*
    â†“ dbt models (transform/models/staging/)
Supabase staging.*
    â†“ dbt models (transform/models/core/)
Supabase core.*
    â†“ dbt models (transform/models/marts/)
Supabase marts.*
    â†“ PostgreSQL datasource
Grafana Cloud
```

---

## ãƒ¢ãƒãƒ¬ãƒæ§‹æˆ

### ãƒªãƒã‚¸ãƒˆãƒªå…¨ä½“ã®ç›®çš„

**LIFETRACER = Personal Data Warehouse Platform**

å€‹äººã®ç”Ÿæ´»ãƒ‡ãƒ¼ã‚¿ï¼ˆå¥åº·ãƒ»æ™‚é–“ãƒ»æ”¯å‡ºï¼‰ã‚’çµ±åˆã—ã€60å¹´é–“ã®é•·æœŸé‹ç”¨ã«è€ãˆã‚‹åˆ†æåŸºç›¤ã‚’æä¾›ã™ã‚‹ã€‚

### ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ

```
lifetracer/                           # ãƒ¢ãƒãƒ¬ãƒãƒ«ãƒ¼ãƒˆ
â”‚
â”œâ”€â”€ pipelines/                        # ãƒ‡ãƒ¼ã‚¿åé›†ï¼ˆPythonï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                       # ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼
â”‚   â”œâ”€â”€ services/                     # APIåŒæœŸã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ fitbit.py
â”‚   â”‚   â”œâ”€â”€ tanita.py
â”‚   â”‚   â”œâ”€â”€ toggl.py
â”‚   â”‚   â”œâ”€â”€ zaim.py
â”‚   â”‚   â”œâ”€â”€ gcalendar.py
â”‚   â”‚   â””â”€â”€ notion.py
â”‚   â”œâ”€â”€ lib/                          # å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆåŸºç›¤æ©Ÿèƒ½ï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ credentials.py            # èªè¨¼æƒ…å ±å–å¾—ãƒ»å¾©å·
â”‚   â”‚   â”œâ”€â”€ db.py                     # Supabase client
â”‚   â”‚   â”œâ”€â”€ encryption.py             # AES-GCMæš—å·åŒ–
â”‚   â”‚   â”œâ”€â”€ logger.py                 # ãƒ­ã‚®ãƒ³ã‚°
â”‚   â”‚   â””â”€â”€ sync_state.py             # åŒæœŸçŠ¶æ…‹ç®¡ç†
â”‚   â””â”€â”€ utils/                        # æ±ç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ dates.py                  # æ—¥ä»˜æ“ä½œ
â”‚       â””â”€â”€ retry.py                  # ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯
â”‚
â”œâ”€â”€ transform/                        # dbt projectï¼ˆãƒ‡ãƒ¼ã‚¿å¤‰æ›ï¼‰
â”‚   â”œâ”€â”€ dbt_project.yml
â”‚   â”œâ”€â”€ profiles.yml
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ staging/                  # raw â†’ staging
â”‚   â”‚   â”‚   â”œâ”€â”€ _sources.yml
â”‚   â”‚   â”‚   â”œâ”€â”€ stg_fitbit__sleep.sql
â”‚   â”‚   â”‚   â”œâ”€â”€ stg_toggl__entries.sql
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ core/                     # staging â†’ coreï¼ˆã‚µãƒ¼ãƒ“ã‚¹éä¾å­˜åŒ–ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ fct_time_entries.sql
â”‚   â”‚   â”‚   â”œâ”€â”€ fct_transactions.sql
â”‚   â”‚   â”‚   â”œâ”€â”€ fct_health_metrics.sql
â”‚   â”‚   â”‚   â””â”€â”€ dim_categories.sql
â”‚   â”‚   â””â”€â”€ marts/                    # core â†’ martsï¼ˆåˆ†æç”¨é›†è¨ˆï¼‰
â”‚   â”‚       â”œâ”€â”€ health/
â”‚   â”‚       â”‚   â””â”€â”€ agg_daily_health.sql
â”‚   â”‚       â”œâ”€â”€ productivity/
â”‚   â”‚       â”‚   â””â”€â”€ agg_weekly_time.sql
â”‚   â”‚       â””â”€â”€ finance/
â”‚   â”‚           â””â”€â”€ agg_monthly_expense.sql
â”‚   â”œâ”€â”€ macros/
â”‚   â”œâ”€â”€ tests/
â”‚   â””â”€â”€ seeds/
â”‚
â”œâ”€â”€ app/                              # ç®¡ç†UIï¼ˆNext.js App Routerï¼‰
â”‚   â”œâ”€â”€ (auth)/
â”‚   â”‚   â””â”€â”€ login/
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ (dashboard)/
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ services/                 # ã‚µãƒ¼ãƒ“ã‚¹æ¥ç¶šç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ secrets/                  # Client Secretç™»éŒ²
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ sync-status/              # åŒæœŸçŠ¶æ…‹ç¢ºèª
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ api/                          # Vercel Functions
â”‚   â”‚   â”œâ”€â”€ register-secret/
â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â””â”€â”€ auth/
â”‚   â”‚       â””â”€â”€ [...nextauth]/
â”‚   â”‚           â””â”€â”€ route.ts
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ServiceCard.tsx
â”‚   â”‚   â”œâ”€â”€ SecretForm.tsx
â”‚   â”‚   â””â”€â”€ SyncStatusTable.tsx
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ supabase.ts
â”‚   â”‚   â””â”€â”€ api-client.ts
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”œâ”€â”€ page.tsx
â”‚   â”œâ”€â”€ globals.css
â”‚   â””â”€â”€ package.json                  # appå°‚ç”¨ã®package.json
â”‚
â”œâ”€â”€ shared/                           # å…±æœ‰å‹å®šç¾©ãƒ»å®šæ•°
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ services.ts               # ServiceNameå‹ã€ServiceConfigå‹
â”‚   â”‚   â”œâ”€â”€ credentials.ts            # èªè¨¼æƒ…å ±å‹
â”‚   â”‚   â”œâ”€â”€ sync.ts                   # åŒæœŸçµæœå‹
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ constants/
â”‚       â”œâ”€â”€ services.ts               # ã‚µãƒ¼ãƒ“ã‚¹ä¸€è¦§å®šæ•°ï¼ˆSERVICESï¼‰
â”‚       â””â”€â”€ schemas.ts                # DBã‚¹ã‚­ãƒ¼ãƒåå®šæ•°
â”‚
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ config.toml
â”‚   â”œâ”€â”€ functions/                    # Edge Functionsï¼ˆDenoï¼‰
â”‚   â”‚   â”œâ”€â”€ oauth-callback-fitbit/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”‚   â””â”€â”€ deno.json
â”‚   â”‚   â”œâ”€â”€ oauth-callback-tanita/
â”‚   â”‚   â”œâ”€â”€ oauth-callback-zaim/
â”‚   â”‚   â””â”€â”€ admin-secret-register/
â”‚   â””â”€â”€ migrations/
â”‚       â”œâ”€â”€ 00001_create_raw_schema.sql
â”‚       â”œâ”€â”€ 00002_create_credentials.sql
â”‚       â””â”€â”€ 00003_create_ref_schema.sql
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ pipelines/                    # pytestï¼ˆPythonåŒæœŸã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼‰
â”‚   â”‚   â”œâ”€â”€ test_fitbit.py
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ transform/                    # dbt testçµæœæ ¼ç´
â”‚   â”œâ”€â”€ app/                          # Vitest/Playwrightï¼ˆç®¡ç†UIï¼‰
â”‚   â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â””â”€â”€ e2e/
â”‚   â””â”€â”€ integration/
â”‚       â””â”€â”€ test_e2e_sync.py
â”‚
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ sync-daily.yml            # pipelines/ å®Ÿè¡Œ
â”‚       â”œâ”€â”€ transform-daily.yml       # dbt run/test
â”‚       â”œâ”€â”€ deploy-app.yml            # Vercelãƒ‡ãƒ—ãƒ­ã‚¤
â”‚       â””â”€â”€ test.yml                  # pytest + dbt test
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ DESIGN.md
â”‚   â”œâ”€â”€ ARCHITECTURE.md               # ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
â”‚   â”œâ”€â”€ SETUP.md                      # ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ
â”‚   â””â”€â”€ USER_SETUP.md                 # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåˆ©ç”¨è€…å‘ã‘
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ setup_local.sh
â”‚   â””â”€â”€ check_dependencies.py
â”‚
â”œâ”€â”€ pyproject.toml                    # Pythonä¾å­˜ç®¡ç†ï¼ˆpipelinesç”¨ï¼‰
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ package.json                      # ãƒ«ãƒ¼ãƒˆpackage.jsonï¼ˆworkspacesç®¡ç†ï¼‰
â”œâ”€â”€ .python-version
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .env.example
â”œâ”€â”€ next.config.js
â”œâ”€â”€ tsconfig.json                     # TypeScriptè¨­å®šï¼ˆshared + appï¼‰
â”œâ”€â”€ vercel.json
â””â”€â”€ README.md
```

### ãƒ•ã‚©ãƒ«ãƒ€ã®è²¬å‹™

| ãƒ•ã‚©ãƒ«ãƒ€ | è²¬å‹™ | è¨€èª/æŠ€è¡“ | å®Ÿè¡Œç’°å¢ƒ |
|---------|------|----------|---------|
| **pipelines/** | å¤–éƒ¨API â†’ rawå±¤ã¸ã®åŒæœŸ | Python 3.12+ | GitHub Actions |
| **transform/** | raw â†’ staging â†’ core â†’ marts | dbt (SQL) | GitHub Actions |
| **app/** | ç®¡ç†UIï¼ˆOAuthå†èªè¨¼ã€è¨­å®šï¼‰ | Next.js | Vercel |
| **shared/** | å‹å®šç¾©ãƒ»å®šæ•°ã®å…±æœ‰ | TypeScript | app/, supabase/functions/ ã‹ã‚‰å‚ç…§ |
| **supabase/** | ã‚¤ãƒ³ãƒ•ãƒ©å®šç¾©ã€Edge Functions | SQL, Deno | Supabase |
| **tests/** | å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ†ã‚¹ãƒˆ | pytest, dbt test, Vitest | ãƒ­ãƒ¼ã‚«ãƒ«/CI |
| **docs/** | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | Markdown | - |

### ä¾å­˜é–¢ä¿‚ã®å¢ƒç•Œ

```
app/ â”€â”€â†’ shared/  âœ… OKï¼ˆå‹å®šç¾©ã‚’å‚ç…§ï¼‰
app/ â”€â”€â†’ pipelines/ âŒ NG
app/ â”€â”€â†’ transform/ âŒ NG

supabase/functions/ â”€â”€â†’ shared/ âœ… OK

pipelines/ â”€â”€â†’ shared/ âš ï¸ å¯èƒ½ã ãŒæ¨å¥¨ã—ãªã„
```

### package.json ã®åˆ†é›¢

**ãƒ«ãƒ¼ãƒˆ `package.json`** (workspacesç®¡ç†)

```json
{
  "name": "lifetracer",
  "version": "1.0.0",
  "private": true,
  "workspaces": ["app"],
  "scripts": {
    "dev": "npm run dev --workspace=app",
    "build": "npm run build --workspace=app"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "typescript": "^5.3.0"
  }
}
```

**app/package.json** (Next.jsä¾å­˜ã‚’é–‰ã˜è¾¼ã‚ã‚‹)

```json
{
  "name": "@lifetracer/app",
  "version": "1.0.0",
  "private": true,
  "dependencies": {
    "next": "^14.0.0",
    "react": "^18.2.0",
    "@supabase/supabase-js": "^2.38.0"
  }
}
```

### ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GitHub Actions (CI/CD)                                      â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ â”‚ sync-daily   â”‚  â”‚ transform    â”‚  â”‚ deploy-app   â”‚      â”‚
â”‚ â”‚ pipelines/   â”‚  â”‚ transform/   â”‚  â”‚ app/         â”‚      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                  â†“                  â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Python  â”‚        â”‚   dbt   â”‚       â”‚ Vercel  â”‚
    â”‚ 3.12+   â”‚        â”‚ (SQL)   â”‚       â”‚ (Edge)  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                  â”‚                  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Supabase           â”‚
         â”‚  - PostgreSQL (DWH) â”‚
         â”‚  - Edge Functions   â”‚
         â”‚  - Auth             â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### TypeScriptè¨­å®šã®åˆ†é›¢

**ãƒ«ãƒ¼ãƒˆ `tsconfig.json`**

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "strict": true,
    "paths": {
      "@shared/*": ["./shared/*"]
    }
  },
  "include": ["shared/**/*"],
  "exclude": ["node_modules", "app"]
}
```

**app/tsconfig.json**

```json
{
  "extends": "../tsconfig.json",
  "compilerOptions": {
    "lib": ["dom", "dom.iterable", "esnext"],
    "jsx": "preserve",
    "paths": {
      "@/*": ["./*"],
      "@shared/*": ["../shared/*"]
    }
  },
  "include": ["**/*.ts", "**/*.tsx"]
}
```

### ç§»è¡Œæˆ¦ç•¥

**Phase 1: PythonåŒæœŸã‚¹ã‚¯ãƒªãƒ—ãƒˆæ§‹ç¯‰**

1. `pipelines/` ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
2. Toggl ã® Pythonå®Ÿè£…ï¼ˆæœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ï¼‰
3. GitHub Actions ã§å‹•ä½œç¢ºèª
4. Denoç‰ˆã¨ã®ä¸¦è¡Œé‹ç”¨ï¼ˆãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§æ¤œè¨¼ï¼‰
5. å…¨ã‚µãƒ¼ãƒ“ã‚¹ç§»è¡Œå¾Œã€`src/` å‰Šé™¤

**Phase 2: dbtå°å…¥**

1. `transform/` ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆã€dbtåˆæœŸåŒ–
2. stagingå±¤ãƒ¢ãƒ‡ãƒ«ä½œæˆï¼ˆ`stg_toggl__entries.sql`ï¼‰
3. coreå±¤ãƒ¢ãƒ‡ãƒ«ä½œæˆï¼ˆ`fct_time_entries.sql`ï¼‰
4. martså±¤ãƒ¢ãƒ‡ãƒ«ä½œæˆï¼ˆ`agg_daily_productivity.sql`ï¼‰
5. GitHub Actionsçµ±åˆï¼ˆ`dbt run && dbt test`ï¼‰

**Phase 3: ç®¡ç†UIï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰**

- Grafana Cloudã§ååˆ†ãªã‚‰ `app/` ã¯ä½œã‚‰ãªã„
- å¿…è¦ã¨åˆ¤æ˜ã—ãŸå ´åˆã®ã¿å®Ÿè£…é–‹å§‹

### ã“ã®æ§‹æˆã®ãƒ¡ãƒªãƒƒãƒˆ

1. **å‹å®‰å…¨æ€§**: `shared/types/` ã§å‹ã‚’ä¸€å…ƒç®¡ç†
2. **ä¾å­˜ã®éš”é›¢**: Next.jsä¾å­˜ã¯ `app/package.json` ã«é–‰ã˜ã‚‹
3. **ãƒ‡ãƒ—ãƒ­ã‚¤ã®ç‹¬ç«‹æ€§**: å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒç‹¬ç«‹ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½
4. **ç®¡ç†ã®ä¸€å…ƒåŒ–**: 1ã¤ã®ãƒªãƒã‚¸ãƒˆãƒªã§å…¨ä½“ã‚’æŠŠæ¡
5. **60å¹´é‹ç”¨æ€æƒ³**: `app/` ã‚’å‰Šé™¤ã—ã¦ã‚‚ `pipelines/` + `transform/` ã¯å‹•ä½œç¶™ç¶š

---

## å®Ÿè£…çŠ¶æ³ã¨è¨­è¨ˆåˆ¤æ–­ï¼ˆ2024å¹´12æœˆï¼‰

### âœ… Phase 1 å®Œäº†: Python ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³åŸºç›¤

**å®Ÿè£…æ¸ˆã¿:**
- Python 3.12+ ç’°å¢ƒ
- `pipelines/lib/` å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒª
  - `credentials.py` - Supabase credentials.services ã‹ã‚‰ã®èªè¨¼æƒ…å ±å–å¾—ãƒ»å¾©å·
  - `db.py` - Supabase ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
  - `encryption.py` - AES-GCM æš—å·åŒ–ï¼ˆDenoç‰ˆã¨äº’æ›ï¼‰
  - `logger.py` - ãƒ­ã‚®ãƒ³ã‚°è¨­å®š
- `pipelines/services/toggl.py` - Toggl Track åŒæœŸå®Ÿè£…
- `tests/pipelines/test_toggl.py` - 12å€‹ã®ãƒ†ã‚¹ãƒˆï¼ˆå…¨ã¦æˆåŠŸï¼‰

**è¨­è¨ˆåˆ¤æ–­ã®è¨˜éŒ²:**

#### 1. rawå±¤ã®ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ: **å‹ä»˜ããƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç¶­æŒ**

**åˆ¤æ–­:** rawå±¤ã¯å‹ä»˜ããƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç¶­æŒã™ã‚‹ï¼ˆå…¨æ–‡å­—åˆ—åŒ–ã—ãªã„ï¼‰

**ç†ç”±:**
- ãƒ‡ãƒ¼ã‚¿å“è³ª: INSERTæ™‚ã«DBå´ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: stagingå±¤ã§æ¯å›CASTã™ã‚‹å¿…è¦ãŒãªã„
- ãƒ‡ãƒãƒƒã‚°: INSERTå¤±æ•—ã§å³åº§ã«ã‚¨ãƒ©ãƒ¼ç™ºè¦‹
- dbtãƒ†ã‚¹ãƒˆ: ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ†ã‚¹ãƒˆè¨˜è¿°

**å®Ÿè£…ä¾‹ï¼ˆTogglï¼‰:**
```python
# pipelines/services/toggl.py
def to_db_entry(entry: TogglTimeEntry) -> DbEntry:
    """APIå‹ â†’ DBå‹ã¸ã®å¤‰æ›ï¼ˆå‹å¼·åˆ¶ï¼‰"""
    return {
        "id": int(entry["id"]),
        "workspace_id": int(entry["workspace_id"]),
        "start": entry["start"],  # ISO8601 â†’ PostgreSQL TIMESTAMPTZ
        "duration_ms": int(entry["duration"]) * 1000,
        "tags": entry.get("tags", []),  # Python list â†’ PostgreSQL TEXT[]
    }
```

#### 2. èªè¨¼æ©Ÿæ§‹: **å¤‰æ›´ãªã—ï¼ˆDenoç‰ˆã¨äº’æ›ï¼‰**

**åˆ¤æ–­:** æ—¢å­˜ã®èªè¨¼æ©Ÿæ§‹ï¼ˆAES-GCM, credentials.servicesï¼‰ã‚’Pythonã§ç§»æ¤

**ç†ç”±:**
- æ—¢å­˜ã®ä»•çµ„ã¿ãŒå …ç‰¢ï¼ˆAES-256-GCM, nonceç®¡ç†ï¼‰
- Pythonç§»æ¤ãŒå®¹æ˜“ï¼ˆ`cryptography` ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰
- ç’°å¢ƒå¤‰æ•° `TOKEN_ENCRYPTION_KEY` ã‚’ç¶™ç¶šåˆ©ç”¨
- Supabaseãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã¯ä¸å¤‰

**å®Ÿè£…ä¾‹:**
```python
# pipelines/lib/encryption.py
from cryptography.hazmat.primitives.ciphers.aead import AESGCM

def decrypt_credentials(data: bytes) -> dict[str, Any]:
    """èªè¨¼æƒ…å ±ã‚’å¾©å·ï¼ˆDenoç‰ˆã¨äº’æ›ï¼‰"""
    key = get_encryption_key()
    aesgcm = AESGCM(key)

    nonce = data[:12]
    ciphertext = data[12:]

    plaintext = aesgcm.decrypt(nonce, ciphertext, None)
    return json.loads(plaintext.decode("utf-8"))

# pipelines/lib/credentials.py
async def get_credentials(service: str) -> CredentialsResult:
    """credentials.servicesã‹ã‚‰èªè¨¼æƒ…å ±ã‚’å–å¾—ãƒ»å¾©å·"""
    supabase = get_supabase_client()

    result = (
        supabase.schema("credentials")
        .table("services")
        .select("credentials_encrypted, expires_at")
        .eq("service", service)
        .single()
        .execute()
    )

    encrypted_hex = result.data["credentials_encrypted"]
    encrypted_bytes = hex_to_bytes(encrypted_hex)
    credentials = decrypt_credentials(encrypted_bytes)

    return CredentialsResult(
        credentials=credentials,
        expires_at=expires_at
    )
```

#### 3. Pythonãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ : **1ãƒ•ã‚¡ã‚¤ãƒ«/ã‚µãƒ¼ãƒ“ã‚¹**

**åˆ¤æ–­:** Denoç‰ˆã®åˆ†å‰²æ§‹é€ ï¼ˆauth.ts, api.ts, write_db.tsï¼‰ã‚’Pythonã§ã¯çµ±åˆ

**ç†ç”±:**
- TypeScriptã¯å‹å®šç¾©ãŒå¤§ããåˆ†å‰²ãŒè‡ªç„¶ã€Pythonã¯å‹ãƒ’ãƒ³ãƒˆãŒã‚³ãƒ³ãƒ‘ã‚¯ãƒˆ
- 5ãƒ•ã‚¡ã‚¤ãƒ« Ã— 6ã‚µãƒ¼ãƒ“ã‚¹ = 30ãƒ•ã‚¡ã‚¤ãƒ« â†’ 6ãƒ•ã‚¡ã‚¤ãƒ«ã«å‰Šæ¸›
- èªçŸ¥è² è·ã®è»½æ¸›ï¼ˆ1ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§å®Œçµï¼‰
- å°è¦æ¨¡ï¼ˆ200-300è¡Œï¼‰ãªã‚‰1ãƒ•ã‚¡ã‚¤ãƒ«ãŒæœ€é©

**å®Ÿè£…ä¾‹ï¼ˆToggl: ç´„250è¡Œï¼‰:**
```python
# pipelines/services/toggl.py

# ============================================================================
# Types
# ============================================================================
class TogglTimeEntry(TypedDict): ...
class DbEntry(TypedDict): ...

# ============================================================================
# Authentication
# ============================================================================
async def get_auth_headers() -> dict[str, str]: ...

# ============================================================================
# API Client
# ============================================================================
async def fetch_entries_by_range(start_date: str, end_date: str) -> list[TogglTimeEntry]: ...

# ============================================================================
# DB Transformation
# ============================================================================
def to_db_entry(entry: TogglTimeEntry) -> DbEntry: ...

# ============================================================================
# DB Write
# ============================================================================
async def upsert_entries(entries: list[TogglTimeEntry]) -> int: ...

# ============================================================================
# Main Sync Function
# ============================================================================
async def sync_toggl(days: int = 3) -> SyncResult: ...
```

#### 4. ãƒ•ã‚©ãƒ«ãƒ€å‘½å: **`pipelines/lib/` (not `core/`)**

**åˆ¤æ–­:** `pipelines/core/` â†’ `pipelines/lib/` ã«å¤‰æ›´

**ç†ç”±:**
- `transform/models/core/` ã¨ã®æ··ä¹±ã‚’å›é¿
- `pipelines/lib/` = Pythonãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆå®Ÿè¡Œæ™‚ä¾å­˜ï¼‰
- `transform/models/core/` = dbtãƒ¢ãƒ‡ãƒ«ï¼ˆãƒ“ã‚¸ãƒã‚¹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼‰
- Pythonã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®æ…£ç¿’ï¼ˆDjango, FastAPIã§ã‚‚ `lib/` ã‚’ä½¿ç”¨ï¼‰

**è²¬å‹™ã®åˆ†é›¢:**
```
pipelines/
â”œâ”€â”€ services/      # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆAPIåŒæœŸï¼‰
â”œâ”€â”€ lib/          # æ±ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆå†åˆ©ç”¨å¯èƒ½ï¼‰
â”‚   â”œâ”€â”€ credentials.py  # å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ æ¥ç¶š
â”‚   â”œâ”€â”€ db.py
â”‚   â”œâ”€â”€ encryption.py
â”‚   â””â”€â”€ logger.py
â””â”€â”€ utils/        # ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ï¼ˆç‰¹å®šã‚¿ã‚¹ã‚¯ç”¨ï¼‰
    â”œâ”€â”€ dates.py
    â””â”€â”€ retry.py
```

---

## ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã¨å“è³ªä¿è¨¼

### Toggl Pipeline ãƒ†ã‚¹ãƒˆï¼ˆ12å€‹ã€å…¨ã¦æˆåŠŸï¼‰

**å˜ä½“ãƒ†ã‚¹ãƒˆ:**
- âœ… èªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼ç”Ÿæˆï¼ˆæ­£å¸¸ç³»ãƒ»ç•°å¸¸ç³»ï¼‰
- âœ… APIå‘¼ã³å‡ºã—ï¼ˆæ­£å¸¸ç³»ãƒ»500ç³»ãƒªãƒˆãƒ©ã‚¤ãƒ»4xxã‚¨ãƒ©ãƒ¼å‡¦ç†ï¼‰
- âœ… APIå‹ â†’ DBå‹å¤‰æ›ï¼ˆå…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ»æœ€å°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰
- âœ… DBæ›¸ãè¾¼ã¿ï¼ˆæ­£å¸¸ç³»ãƒ»å®Ÿè¡Œä¸­ã‚¨ãƒ³ãƒˆãƒªãƒ¼é™¤å¤–ãƒ»ç©ºãƒªã‚¹ãƒˆï¼‰

**çµ±åˆãƒ†ã‚¹ãƒˆ:**
- âœ… `sync_toggl()` ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰
- âœ… æ—¥ä»˜ç¯„å›²è¨ˆç®—ã®æ¤œè¨¼

**å®Ÿè¡Œçµæœ:**
```bash
$ pytest tests/pipelines/test_toggl.py -v
============================= test session starts =============================
collected 12 items

tests/pipelines/test_toggl.py::test_get_auth_headers_success PASSED      [  8%]
tests/pipelines/test_toggl.py::test_get_auth_headers_missing_token PASSED [ 16%]
tests/pipelines/test_toggl.py::test_fetch_entries_by_range_success PASSED [ 25%]
tests/pipelines/test_toggl.py::test_fetch_entries_by_range_500_retry PASSED [ 33%]
tests/pipelines/test_toggl.py::test_fetch_entries_by_range_400_no_retry PASSED [ 41%]
tests/pipelines/test_toggl.py::test_to_db_entry PASSED                   [ 50%]
tests/pipelines/test_toggl.py::test_to_db_entry_minimal PASSED           [ 58%]
tests/pipelines/test_toggl.py::test_upsert_entries_success PASSED        [ 66%]
tests/pipelines/test_toggl.py::test_upsert_entries_filters_running PASSED [ 75%]
tests/pipelines/test_toggl.py::test_upsert_entries_empty PASSED          [ 83%]
tests/pipelines/test_toggl.py::test_sync_toggl_success PASSED            [ 91%]
tests/pipelines/test_toggl.py::test_sync_toggl_date_range PASSED         [100%]

============================= 12 passed in 2.59s ==============================
```

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### ğŸ”´ å„ªå…ˆåº¦ï¼šé«˜ï¼ˆPhase 2ï¼‰

| ã‚¿ã‚¹ã‚¯ | å†…å®¹ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|--------|------|------------|
| ä»–ã‚µãƒ¼ãƒ“ã‚¹ã®Pythonç§»è¡Œ | fitbit, tanita, zaim, gcalendar, notion ã‚’ Python ã§å®Ÿè£… | æœªç€æ‰‹ |
| GitHub Actionsçµ±åˆ | `.github/workflows/sync-daily.yml` ã‚’ Pythonå®Ÿè¡Œã«å¤‰æ›´ | æœªç€æ‰‹ |
| Denoç‰ˆã¨ã®ä¸¦è¡Œé‹ç”¨ | ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§æ¤œè¨¼ï¼ˆ1-2é€±é–“ï¼‰ | æœªç€æ‰‹ |
| Phase 6-8ã®å®Œäº† | åŒæœŸãƒ†ã‚¹ãƒˆã€.envæ•´ç†ã€æ—§tokensãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤ | æœªç€æ‰‹ |

### ğŸŸ¡ å„ªå…ˆåº¦ï¼šä¸­ï¼ˆPhase 3ï¼‰

| ã‚¿ã‚¹ã‚¯ | å†…å®¹ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|--------|------|------------|
| dbtå°å…¥ | `transform/` ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆã€staging/core/martså±¤ã®æ§‹ç¯‰ | æœªç€æ‰‹ |
| Denoç‰ˆå‰Šé™¤ | å…¨ã‚µãƒ¼ãƒ“ã‚¹ç§»è¡Œå®Œäº†å¾Œã€`src/` ãƒ•ã‚©ãƒ«ãƒ€å‰Šé™¤ | æœªç€æ‰‹ |

### ğŸŸ¢ å„ªå…ˆåº¦ï¼šä½ï¼ˆå°†æ¥å¯¾å¿œï¼‰

| ã‚¿ã‚¹ã‚¯ | å†…å®¹ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|--------|------|------------|
| ç®¡ç†UIæ§‹ç¯‰ | Vercel + Next.jsï¼ˆGrafana Cloudã§ååˆ†ãªã‚‰ä¸è¦ï¼‰ | ä¿ç•™ |
| Grafana Cloudé€£æº | PostgreSQLãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹è¨­å®šã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä½œæˆ | æœªç€æ‰‹ |

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã®æœ€çµ‚æ±ºå®š

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | æŠ€è¡“ | å®Ÿè£…çŠ¶æ³ |
|---------|------|---------|
| **APIåŒæœŸ â†’ raw** | Python 3.12+ | âœ… Togglå®Ÿè£…å®Œäº† |
| **raw â†’ staging** | dbt (SQL) | æœªç€æ‰‹ |
| **staging â†’ core** | dbt (SQL) | æœªç€æ‰‹ |
| **core â†’ marts** | dbt (SQL) | æœªç€æ‰‹ |
| **èªè¨¼ãƒ»æš—å·åŒ–** | Python (cryptography) | âœ… å®Ÿè£…å®Œäº† |
| **DBæ¥ç¶š** | Python (supabase-py) | âœ… å®Ÿè£…å®Œäº† |
| **ãƒ†ã‚¹ãƒˆ** | pytest + pytest-asyncio | âœ… Togglå®Œäº† |
| **ç®¡ç†UI** | Next.js + Vercel | ä¿ç•™ |
| **OAuth Callback** | Deno (Edge Functions) | æœªç€æ‰‹ |
| **å¯è¦–åŒ–** | Grafana Cloud | æœªç€æ‰‹ |

---

## å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

### Python 3.14.0 å¯¾å¿œ

- ScoopçµŒç”±ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- `python3` ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œï¼ˆ`python` ã¯ä»®æƒ³ç’°å¢ƒå†…ã®ã¿ï¼‰
- ä»®æƒ³ç’°å¢ƒï¼ˆ`.venv`ï¼‰ã®ä½¿ç”¨ã‚’æ¨å¥¨

### ä»®æƒ³ç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# 1å›ã ã‘å®Ÿè¡Œï¼ˆåˆå›ï¼‰
python3 -m venv .venv
.venv/Scripts/pip install -r requirements.txt

# æ¯å›å®Ÿè¡Œï¼ˆé–‹ç™ºæ™‚ï¼‰
source .venv/Scripts/activate  # Git Bash
pytest tests/pipelines/test_toggl.py -v
```

### ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®å®Ÿè·µ

- å®Ÿè£…å‰ã«ãƒ†ã‚¹ãƒˆã‚’ä½œæˆ
- ãƒ¢ãƒƒã‚¯ï¼ˆpytest-mockï¼‰ã‚’æ´»ç”¨
- éåŒæœŸãƒ†ã‚¹ãƒˆï¼ˆpytest-asyncioï¼‰ã®ç†è§£